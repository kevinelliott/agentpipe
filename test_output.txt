go: downloading github.com/kylelemons/godebug v1.1.0
?   	github.com/kevinelliott/agentpipe	[no test files]
=== RUN   TestParseAgentSpec
=== RUN   TestParseAgentSpec/type_only
=== RUN   TestParseAgentSpec/type:name_format
=== RUN   TestParseAgentSpec/type:model:name_format
[90m2025-10-29T02:57:14Z[0m DBG loaded embedded provider config [36mproviders=[0m16 [36msource=[0membedded [36mversion=[0m1.0
[90m2025-10-29T02:57:14Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mclaude [36mmodel=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
=== RUN   TestParseAgentSpec/openrouter_without_model_(error)
=== RUN   TestParseAgentSpec/openrouter_with_model
[90m2025-10-29T02:57:14Z[0m [33mWRN[0m [1mmodel not found in provider registry (cost estimates may be inaccurate)[0m [36magent_type=[0mopenrouter [36mmodel=[0manthropic/claude-sonnet-4-5
=== RUN   TestParseAgentSpec/openrouter_with_different_model_format
[90m2025-10-29T02:57:14Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Google: Gemini 2.5 Pro" [36mmodel_id=[0mgoogle/gemini-2.5-pro [36mprovider=[0mOpenRouter
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mopenrouter [36mmodel=[0mgoogle/gemini-2.5-pro [36mprovider=[0mOpenRouter
=== RUN   TestParseAgentSpec/kimi_with_model_(error)
=== RUN   TestParseAgentSpec/cursor_with_model_(error)
=== RUN   TestParseAgentSpec/amp_with_model_(error)
=== RUN   TestParseAgentSpec/gemini_without_model
=== RUN   TestParseAgentSpec/gemini_with_model
[90m2025-10-29T02:57:14Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Gemini 2.5 Pro" [36mmodel_id=[0mgemini-2.5-pro [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mgemini [36mmodel=[0mgemini-2.5-pro [36mprovider=[0mAIHubMix
=== RUN   TestParseAgentSpec/qwen_with_model
[90m2025-10-29T02:57:14Z[0m [33mWRN[0m [1mfound model via fuzzy match - this may not be accurate[0m [36mactual_id=[0mqwen/qwen-plus-2025-07-28 [36mmatch=[0mfuzzy [36mmodel=[0m"Qwen: Qwen Plus 0728" [36mmodel_id=[0mqwen-plus [36mprovider=[0mOpenRouter
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mqwen [36mmodel=[0mqwen/qwen-plus-2025-07-28 [36mprovider=[0mOpenRouter
=== RUN   TestParseAgentSpec/factory_with_model
[90m2025-10-29T02:57:14Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mfactory [36mmodel=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
=== RUN   TestParseAgentSpec/qoder_with_model
[90m2025-10-29T02:57:14Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mqoder [36mmodel=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
=== RUN   TestParseAgentSpec/codex_with_model
[90m2025-10-29T02:57:14Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mgpt-4.1 [36mmatch=[0mprefix [36mmodel=[0mGPT-4.1 [36mmodel_id=[0mgpt-4 [36mprovider=[0m"Azure OpenAI"
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mcodex [36mmodel=[0mgpt-4.1 [36mprovider=[0m"Azure OpenAI"
=== RUN   TestParseAgentSpec/groq_with_model
=== RUN   TestParseAgentSpec/crush_with_model
[90m2025-10-29T02:57:14Z[0m [33mWRN[0m [1mfound model via fuzzy match - this may not be accurate[0m [36mactual_id=[0mdeepseek-ai/DeepSeek-R1-0528 [36mmatch=[0mfuzzy [36mmodel=[0m"DeepSeek R1 0528" [36mmodel_id=[0mdeepseek-r1 [36mprovider=[0mChutes
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mcrush [36mmodel=[0mdeepseek-ai/DeepSeek-R1-0528 [36mprovider=[0mChutes
=== RUN   TestParseAgentSpec/empty_spec
=== RUN   TestParseAgentSpec/unknown_agent_type
=== RUN   TestParseAgentSpec/too_many_parts
=== RUN   TestParseAgentSpec/model_with_slash_(OpenRouter_style)
[90m2025-10-29T02:57:14Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Anthropic: Claude 3.5 Sonnet" [36mmodel_id=[0manthropic/claude-3.5-sonnet [36mprovider=[0mOpenRouter
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mopenrouter [36mmodel=[0manthropic/claude-3.5-sonnet [36mprovider=[0mOpenRouter
=== RUN   TestParseAgentSpec/name_with_special_characters
[90m2025-10-29T02:57:14Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mclaude [36mmodel=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
=== RUN   TestParseAgentSpec/type_only_with_index_0
=== RUN   TestParseAgentSpec/type_only_with_index_5
--- PASS: TestParseAgentSpec (0.04s)
    --- PASS: TestParseAgentSpec/type_only (0.00s)
    --- PASS: TestParseAgentSpec/type:name_format (0.00s)
    --- PASS: TestParseAgentSpec/type:model:name_format (0.03s)
    --- PASS: TestParseAgentSpec/openrouter_without_model_(error) (0.00s)
    --- PASS: TestParseAgentSpec/openrouter_with_model (0.00s)
    --- PASS: TestParseAgentSpec/openrouter_with_different_model_format (0.00s)
    --- PASS: TestParseAgentSpec/kimi_with_model_(error) (0.00s)
    --- PASS: TestParseAgentSpec/cursor_with_model_(error) (0.00s)
    --- PASS: TestParseAgentSpec/amp_with_model_(error) (0.00s)
    --- PASS: TestParseAgentSpec/gemini_without_model (0.00s)
    --- PASS: TestParseAgentSpec/gemini_with_model (0.00s)
    --- PASS: TestParseAgentSpec/qwen_with_model (0.00s)
    --- PASS: TestParseAgentSpec/factory_with_model (0.00s)
    --- PASS: TestParseAgentSpec/qoder_with_model (0.00s)
    --- PASS: TestParseAgentSpec/codex_with_model (0.00s)
    --- PASS: TestParseAgentSpec/groq_with_model (0.00s)
    --- PASS: TestParseAgentSpec/crush_with_model (0.00s)
    --- PASS: TestParseAgentSpec/empty_spec (0.00s)
    --- PASS: TestParseAgentSpec/unknown_agent_type (0.00s)
    --- PASS: TestParseAgentSpec/too_many_parts (0.00s)
    --- PASS: TestParseAgentSpec/model_with_slash_(OpenRouter_style) (0.00s)
    --- PASS: TestParseAgentSpec/name_with_special_characters (0.00s)
    --- PASS: TestParseAgentSpec/type_only_with_index_0 (0.00s)
    --- PASS: TestParseAgentSpec/type_only_with_index_5 (0.00s)
=== RUN   TestParseAgentSpecWithModel
=== RUN   TestParseAgentSpecWithModel/single_part_-_type_only
=== RUN   TestParseAgentSpecWithModel/two_parts_-_type:name
=== RUN   TestParseAgentSpecWithModel/three_parts_-_type:model:name
[90m2025-10-29T02:57:14Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:14Z[0m DBG model validated in provider registry [36magent_type=[0mclaude [36mmodel=[0mclaude-sonnet-4-5 [36mprovider=[0mAIHubMix
=== RUN   TestParseAgentSpecWithModel/empty_spec
=== RUN   TestParseAgentSpecWithModel/four_parts_-_invalid
=== RUN   TestParseAgentSpecWithModel/unknown_type
=== RUN   TestParseAgentSpecWithModel/agent_doesn't_support_model
=== RUN   TestParseAgentSpecWithModel/agent_requires_model_but_not_provided
--- PASS: TestParseAgentSpecWithModel (0.00s)
    --- PASS: TestParseAgentSpecWithModel/single_part_-_type_only (0.00s)
    --- PASS: TestParseAgentSpecWithModel/two_parts_-_type:name (0.00s)
    --- PASS: TestParseAgentSpecWithModel/three_parts_-_type:model:name (0.00s)
    --- PASS: TestParseAgentSpecWithModel/empty_spec (0.00s)
    --- PASS: TestParseAgentSpecWithModel/four_parts_-_invalid (0.00s)
    --- PASS: TestParseAgentSpecWithModel/unknown_type (0.00s)
    --- PASS: TestParseAgentSpecWithModel/agent_doesn't_support_model (0.00s)
    --- PASS: TestParseAgentSpecWithModel/agent_requires_model_but_not_provided (0.00s)
=== RUN   TestValidateAgentType
=== RUN   TestValidateAgentType/valid_claude
=== RUN   TestValidateAgentType/valid_gemini
=== RUN   TestValidateAgentType/valid_openrouter
=== RUN   TestValidateAgentType/valid_kimi
=== RUN   TestValidateAgentType/empty_type
=== RUN   TestValidateAgentType/unknown_type
--- PASS: TestValidateAgentType (0.00s)
    --- PASS: TestValidateAgentType/valid_claude (0.00s)
    --- PASS: TestValidateAgentType/valid_gemini (0.00s)
    --- PASS: TestValidateAgentType/valid_openrouter (0.00s)
    --- PASS: TestValidateAgentType/valid_kimi (0.00s)
    --- PASS: TestValidateAgentType/empty_type (0.00s)
    --- PASS: TestValidateAgentType/unknown_type (0.00s)
=== RUN   TestValidateModelForAgent
=== RUN   TestValidateModelForAgent/claude_with_model
=== RUN   TestValidateModelForAgent/claude_without_model
=== RUN   TestValidateModelForAgent/gemini_with_model
=== RUN   TestValidateModelForAgent/openrouter_with_model
=== RUN   TestValidateModelForAgent/openrouter_without_model
=== RUN   TestValidateModelForAgent/kimi_with_model
=== RUN   TestValidateModelForAgent/kimi_without_model
=== RUN   TestValidateModelForAgent/cursor_with_model
=== RUN   TestValidateModelForAgent/amp_with_model
=== RUN   TestValidateModelForAgent/unknown_type
--- PASS: TestValidateModelForAgent (0.00s)
    --- PASS: TestValidateModelForAgent/claude_with_model (0.00s)
    --- PASS: TestValidateModelForAgent/claude_without_model (0.00s)
    --- PASS: TestValidateModelForAgent/gemini_with_model (0.00s)
    --- PASS: TestValidateModelForAgent/openrouter_with_model (0.00s)
    --- PASS: TestValidateModelForAgent/openrouter_without_model (0.00s)
    --- PASS: TestValidateModelForAgent/kimi_with_model (0.00s)
    --- PASS: TestValidateModelForAgent/kimi_without_model (0.00s)
    --- PASS: TestValidateModelForAgent/cursor_with_model (0.00s)
    --- PASS: TestValidateModelForAgent/amp_with_model (0.00s)
    --- PASS: TestValidateModelForAgent/unknown_type (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/cmd	1.066s
?   	github.com/kevinelliott/agentpipe/examples	[no test files]
?   	github.com/kevinelliott/agentpipe/internal/branding	[no test files]
=== RUN   TestNewClient
--- PASS: TestNewClient (0.00s)
=== RUN   TestGetEndpointURL
--- PASS: TestGetEndpointURL (0.00s)
=== RUN   TestSendEvent_Success
Debug: Successfully sent conversation.started event
--- PASS: TestSendEvent_Success (0.00s)
=== RUN   TestSendEvent_Disabled
--- PASS: TestSendEvent_Disabled (0.00s)
=== RUN   TestSendEvent_NoAPIKey
Debug: Streaming enabled but no API key configured
--- PASS: TestSendEvent_NoAPIKey (0.00s)
=== RUN   TestSendEvent_Unauthorized

⚠️  Bridge streaming unavailable - conversation will continue normally
   (Events will be saved locally and can be uploaded later)
Debug: Failed to stream event after 1 attempts: HTTP 401: {"error":"Invalid API key"}

--- PASS: TestSendEvent_Unauthorized (0.00s)
=== RUN   TestSendEvent_ServerError

⚠️  Bridge streaming unavailable - conversation will continue normally
   (Events will be saved locally and can be uploaded later)
Debug: Failed to stream event after 1 attempts: HTTP 500: Internal server error
--- PASS: TestSendEvent_ServerError (0.00s)
=== RUN   TestSendEvent_Retry
Debug: Retry attempt 1/3 after 1s
Debug: Retry attempt 2/3 after 2s
Debug: Successfully sent conversation.started event
--- PASS: TestSendEvent_Retry (3.00s)
=== RUN   TestSendEvent_NoRetryOn4xx

⚠️  Bridge streaming unavailable - conversation will continue normally
   (Events will be saved locally and can be uploaded later)
Debug: Failed to stream event after 4 attempts: HTTP 400: Bad request
--- PASS: TestSendEvent_NoRetryOn4xx (0.00s)
=== RUN   TestSendEventAsync
Debug: Successfully sent conversation.started event
--- PASS: TestSendEventAsync (0.00s)
=== RUN   TestIsClientError
--- PASS: TestIsClientError (0.00s)
=== RUN   TestLoadConfig_Defaults
    config_test.go:44: Default URL: http://localhost:3000
--- PASS: TestLoadConfig_Defaults (0.00s)
=== RUN   TestLoadConfig_EnvironmentVariables
--- PASS: TestLoadConfig_EnvironmentVariables (0.00s)
=== RUN   TestLoadConfig_ViperConfig
--- PASS: TestLoadConfig_ViperConfig (0.00s)
=== RUN   TestLoadConfig_EnvironmentOverridesViper
--- PASS: TestLoadConfig_EnvironmentOverridesViper (0.00s)
=== RUN   TestCleanBaseURL
--- PASS: TestCleanBaseURL (0.00s)
=== RUN   TestGetDefaultURL
    config_test.go:191: Default URL (no env var): http://localhost:3000
--- PASS: TestGetDefaultURL (0.00s)
=== RUN   TestLoadConfig_EnabledVariations
=== RUN   TestLoadConfig_EnabledVariations/enabled=true
=== RUN   TestLoadConfig_EnabledVariations/enabled=1
=== RUN   TestLoadConfig_EnabledVariations/enabled=false
=== RUN   TestLoadConfig_EnabledVariations/enabled=0
=== RUN   TestLoadConfig_EnabledVariations/enabled=
--- PASS: TestLoadConfig_EnabledVariations (0.00s)
    --- PASS: TestLoadConfig_EnabledVariations/enabled=true (0.00s)
    --- PASS: TestLoadConfig_EnabledVariations/enabled=1 (0.00s)
    --- PASS: TestLoadConfig_EnabledVariations/enabled=false (0.00s)
    --- PASS: TestLoadConfig_EnabledVariations/enabled=0 (0.00s)
    --- PASS: TestLoadConfig_EnabledVariations/enabled= (0.00s)
=== RUN   TestNewEmitter

⚠️  Bridge streaming unavailable - conversation will continue normally
   (Events will be saved locally and can be uploaded later)
--- PASS: TestNewEmitter (7.03s)
=== RUN   TestGetConversationID

⚠️  Bridge streaming unavailable - conversation will continue normally
   (Events will be saved locally and can be uploaded later)
--- PASS: TestGetConversationID (0.02s)
=== RUN   TestEmitConversationStarted
Debug: Successfully sent bridge.connected event
--- PASS: TestEmitConversationStarted (0.01s)
Debug: Successfully sent conversation.started event
=== RUN   TestEmitMessageCreated
Debug: Successfully sent bridge.connected event
Debug: Successfully sent message.created event
Debug: Successfully sent message.created event
--- PASS: TestEmitMessageCreated (0.01s)
=== RUN   TestEmitConversationCompleted
Debug: Successfully sent bridge.connected event
Debug: Successfully sent conversation.completed event
--- PASS: TestEmitConversationCompleted (0.01s)
=== RUN   TestEmitConversationError
Debug: Successfully sent bridge.connected event
Debug: Successfully sent conversation.error event
--- PASS: TestEmitConversationError (0.00s)
=== RUN   TestSequenceNumbering
--- PASS: TestSequenceNumbering (0.00s)
=== RUN   TestUniqueConversationIDs

⚠️  Bridge streaming unavailable - conversation will continue normally
   (Events will be saved locally and can be uploaded later)

⚠️  Bridge streaming unavailable - conversation will continue normally
   (Events will be saved locally and can be uploaded later)

⚠️  Bridge streaming unavailable - conversation will continue normally
   (Events will be saved locally and can be uploaded later)
--- PASS: TestUniqueConversationIDs (0.02s)
=== RUN   TestBridgeConnectedEvent
Debug: Successfully sent bridge.connected event
--- PASS: TestBridgeConnectedEvent (0.00s)
=== RUN   TestEventJSONSerialization
--- PASS: TestEventJSONSerialization (0.00s)
=== RUN   TestMessageCreatedEvent
--- PASS: TestMessageCreatedEvent (0.00s)
=== RUN   TestConversationCompletedEvent
--- PASS: TestConversationCompletedEvent (0.00s)
=== RUN   TestConversationErrorEvent
--- PASS: TestConversationErrorEvent (0.00s)
=== RUN   TestBridgeTestEvent
--- PASS: TestBridgeTestEvent (0.00s)
=== RUN   TestBridgeConnectedEventJSON
--- PASS: TestBridgeConnectedEventJSON (0.00s)
=== RUN   TestTimestampFormat
--- PASS: TestTimestampFormat (0.00s)
=== RUN   TestOmitemptyFields
--- PASS: TestOmitemptyFields (0.00s)
=== RUN   TestCollectSystemInfo
    sysinfo_test.go:39: Successfully detected OS version: Ubuntu 24.04.3 LTS
--- PASS: TestCollectSystemInfo (0.00s)
=== RUN   TestGetOSVersion
    sysinfo_test.go:74: Detected OS version: Ubuntu 24.04.3 LTS
--- PASS: TestGetOSVersion (0.00s)
=== RUN   TestGetMacOSVersion
    sysinfo_test.go:79: Skipping macOS-specific test on non-macOS platform
--- SKIP: TestGetMacOSVersion (0.00s)
=== RUN   TestGetLinuxVersion
    sysinfo_test.go:114: Linux version: Ubuntu 24.04.3 LTS
--- PASS: TestGetLinuxVersion (0.00s)
=== RUN   TestGetWindowsVersion
    sysinfo_test.go:119: Skipping Windows-specific test on non-Windows platform
--- SKIP: TestGetWindowsVersion (0.00s)
=== RUN   TestSystemInfoJSONSerialization
--- PASS: TestSystemInfoJSONSerialization (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/internal/bridge	11.144s
=== RUN   TestFetchProviderFromCatwalk
    fetcher_test.go:31: Fetched provider: Anthropic with 9 models
--- PASS: TestFetchProviderFromCatwalk (0.63s)
=== RUN   TestFetchProvidersFromCatwalk
    fetcher_test.go:62: Fetched 16 providers from Catwalk
--- PASS: TestFetchProvidersFromCatwalk (3.17s)
=== RUN   TestGetRegistry
[90m2025-10-29T02:57:18Z[0m DBG loaded embedded provider config [36mproviders=[0m16 [36msource=[0membedded [36mversion=[0m1.0
    registry_test.go:24: Loaded 16 providers
--- PASS: TestGetRegistry (0.01s)
=== RUN   TestGetProvider
=== RUN   TestGetProvider/anthropic
=== RUN   TestGetProvider/openai
=== RUN   TestGetProvider/gemini
=== RUN   TestGetProvider/deepseek
=== RUN   TestGetProvider/nonexistent
--- PASS: TestGetProvider (0.00s)
    --- PASS: TestGetProvider/anthropic (0.00s)
    --- PASS: TestGetProvider/openai (0.00s)
    --- PASS: TestGetProvider/gemini (0.00s)
    --- PASS: TestGetProvider/deepseek (0.00s)
    --- PASS: TestGetProvider/nonexistent (0.00s)
=== RUN   TestGetModel
=== RUN   TestGetModel/claude-sonnet-4-5-20250929
[90m2025-10-29T02:57:18Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5-20250929 [36mprovider=[0mAnthropic
    registry_test.go:97: Found model claude-sonnet-4-5-20250929 (Claude Sonnet 4.5) from provider Anthropic via exact match
=== RUN   TestGetModel/gpt-5
[90m2025-10-29T02:57:18Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0mGPT-5 [36mmodel_id=[0mgpt-5 [36mprovider=[0mAIHubMix
    registry_test.go:97: Found model gpt-5 (GPT-5) from provider AIHubMix via exact match
=== RUN   TestGetModel/gemini-2.5-pro
[90m2025-10-29T02:57:18Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Gemini 2.5 Pro" [36mmodel_id=[0mgemini-2.5-pro [36mprovider=[0mAIHubMix
    registry_test.go:97: Found model gemini-2.5-pro (Gemini 2.5 Pro) from provider AIHubMix via exact match
=== RUN   TestGetModel/claude-sonnet-4
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4 [36mprovider=[0mAIHubMix
    registry_test.go:97: Found model claude-sonnet-4-5 (Claude Sonnet 4.5) from provider AIHubMix via prefix match
=== RUN   TestGetModel/gpt
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mgpt-5 [36mmatch=[0mprefix [36mmodel=[0mGPT-5 [36mmodel_id=[0mgpt [36mprovider=[0mAIHubMix
    registry_test.go:97: Found model gpt-5 (GPT-5) from provider AIHubMix via prefix match
=== RUN   TestGetModel/totally-fake-model
--- PASS: TestGetModel (0.00s)
    --- PASS: TestGetModel/claude-sonnet-4-5-20250929 (0.00s)
    --- PASS: TestGetModel/gpt-5 (0.00s)
    --- PASS: TestGetModel/gemini-2.5-pro (0.00s)
    --- PASS: TestGetModel/claude-sonnet-4 (0.00s)
    --- PASS: TestGetModel/gpt (0.00s)
    --- PASS: TestGetModel/totally-fake-model (0.00s)
=== RUN   TestListProviders
--- PASS: TestListProviders (0.00s)
=== RUN   TestRegistryReload
[90m2025-10-29T02:57:18Z[0m DBG loaded embedded provider config [36mproviders=[0m16 [36msource=[0membedded [36mversion=[0m1.0
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mloaded provider override config[0m [36mpath=[0m/home/runner/.agentpipe/providers.json [36mproviders=[0m1 [36msource=[0moverride [36mupdated=[0m2025-01-01T00:00:00Z [36mversion=[0mtest
--- PASS: TestRegistryReload (0.01s)
=== RUN   TestModelPricing
[90m2025-10-29T02:57:18Z[0m DBG loaded embedded provider config [36mproviders=[0m16 [36msource=[0membedded [36mversion=[0m1.0
[90m2025-10-29T02:57:18Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5-20250929 [36mprovider=[0mAnthropic
    registry_test.go:227: Claude Sonnet 4.5 pricing: $3.00 in / $15.00 out per 1M tokens
--- PASS: TestModelPricing (0.01s)
=== RUN   TestProviderConfigStructure
[90m2025-10-29T02:57:18Z[0m DBG loaded embedded provider config [36mproviders=[0m16 [36msource=[0membedded [36mversion=[0m1.0
    registry_test.go:250: Provider config: version=1.0, updated=2025-10-25T21:38:20Z, source=https://github.com/charmbracelet/catwalk
--- PASS: TestProviderConfigStructure (0.01s)
PASS
ok  	github.com/kevinelliott/agentpipe/internal/providers	4.870s
=== RUN   TestLoadRegistry
--- PASS: TestLoadRegistry (0.00s)
=== RUN   TestGetAll
--- PASS: TestGetAll (0.00s)
=== RUN   TestGetByName
=== RUN   TestGetByName/Claude
=== RUN   TestGetByName/claude
=== RUN   TestGetByName/CLAUDE
=== RUN   TestGetByName/Ollama
=== RUN   TestGetByName/NonExistent
--- PASS: TestGetByName (0.00s)
    --- PASS: TestGetByName/Claude (0.00s)
    --- PASS: TestGetByName/claude (0.00s)
    --- PASS: TestGetByName/CLAUDE (0.00s)
    --- PASS: TestGetByName/Ollama (0.00s)
    --- PASS: TestGetByName/NonExistent (0.00s)
=== RUN   TestGetByCommand
=== RUN   TestGetByCommand/claude
=== RUN   TestGetByCommand/ollama
=== RUN   TestGetByCommand/gemini
=== RUN   TestGetByCommand/nonexistent
--- PASS: TestGetByCommand (0.00s)
    --- PASS: TestGetByCommand/claude (0.00s)
    --- PASS: TestGetByCommand/ollama (0.00s)
    --- PASS: TestGetByCommand/gemini (0.00s)
    --- PASS: TestGetByCommand/nonexistent (0.00s)
=== RUN   TestGetInstallCommand
--- PASS: TestGetInstallCommand (0.00s)
=== RUN   TestGetUpgradeCommand
--- PASS: TestGetUpgradeCommand (0.00s)
=== RUN   TestIsInstallable
=== RUN   TestIsInstallable/Claude
=== RUN   TestIsInstallable/Amp
--- PASS: TestIsInstallable (0.00s)
    --- PASS: TestIsInstallable/Claude (0.00s)
    --- PASS: TestIsInstallable/Amp (0.00s)
=== RUN   TestAgentMetadata
--- PASS: TestAgentMetadata (0.00s)
=== RUN   TestOllamaDoesNotRequireAuth
--- PASS: TestOllamaDoesNotRequireAuth (0.00s)
=== RUN   TestClaudePackageNameConsistency
--- PASS: TestClaudePackageNameConsistency (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/internal/registry	1.021s
?   	github.com/kevinelliott/agentpipe/internal/version	[no test files]
=== RUN   TestBuildAgentPrompt
=== RUN   TestBuildAgentPrompt/basic_prompt
=== RUN   TestBuildAgentPrompt/empty_system_prompt
=== RUN   TestBuildAgentPrompt/multi-line_conversation
--- PASS: TestBuildAgentPrompt (0.00s)
    --- PASS: TestBuildAgentPrompt/basic_prompt (0.00s)
    --- PASS: TestBuildAgentPrompt/empty_system_prompt (0.00s)
    --- PASS: TestBuildAgentPrompt/multi-line_conversation (0.00s)
=== RUN   TestClaudeAgentInitialization
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mclaude CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"claude\": executable file not found in $PATH"[0m[0m [36magent_id=[0mclaude-1 [36magent_name=[0mClaude
    adapters_test.go:81: claude CLI not available, skipping test
--- SKIP: TestClaudeAgentInitialization (0.00s)
=== RUN   TestGeminiAgentInitialization
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mgemini CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"gemini\": executable file not found in $PATH"[0m[0m [36magent_id=[0mgemini-1 [36magent_name=[0mGemini
    adapters_test.go:115: gemini CLI not available, skipping test
--- SKIP: TestGeminiAgentInitialization (0.00s)
=== RUN   TestCopilotAgentInitialization
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mcopilot CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"copilot\": executable file not found in $PATH"[0m[0m [36magent_id=[0mcopilot-1 [36magent_name=[0mCopilot
    adapters_test.go:143: copilot CLI not available, skipping test
--- SKIP: TestCopilotAgentInitialization (0.00s)
=== RUN   TestCursorAgentInitialization
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mcursor-agent CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"cursor-agent\": executable file not found in $PATH"[0m[0m [36magent_id=[0mcursor-1 [36magent_name=[0mCursor [36magent_type=[0mcursor
    adapters_test.go:170: cursor CLI not available, skipping test
--- SKIP: TestCursorAgentInitialization (0.00s)
=== RUN   TestQwenAgentInitialization
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mqwen CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"qwen\": executable file not found in $PATH"[0m[0m [36magent_id=[0mqwen-1 [36magent_name=[0mQwen
    adapters_test.go:194: qwen CLI not available, skipping test
--- SKIP: TestQwenAgentInitialization (0.00s)
=== RUN   TestCodexAgentInitialization
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mcodex CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"codex\": executable file not found in $PATH"[0m[0m [36magent_id=[0mcodex-1 [36magent_name=[0mCodex
    adapters_test.go:218: codex CLI not available, skipping test
--- SKIP: TestCodexAgentInitialization (0.00s)
=== RUN   TestAmpAgentInitialization
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mamp CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"amp\": executable file not found in $PATH"[0m[0m [36magent_id=[0mamp-1 [36magent_name=[0mAmp
    adapters_test.go:243: amp CLI not available, skipping test
--- SKIP: TestAmpAgentInitialization (0.00s)
=== RUN   TestAiderAgentInitialization
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1maider CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"aider\": executable file not found in $PATH"[0m[0m [36magent_id=[0maider-1 [36magent_name=[0mAider
    adapters_test.go:274: aider CLI not available, skipping test
--- SKIP: TestAiderAgentInitialization (0.00s)
=== RUN   TestAgentAnnouncement
=== RUN   TestAgentAnnouncement/claude
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mclaude CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"claude\": executable file not found in $PATH"[0m[0m [36magent_id=[0mclaude-1 [36magent_name=[0mClaude
    adapters_test.go:320: claude CLI not available, skipping test
=== RUN   TestAgentAnnouncement/gemini
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mgemini CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"gemini\": executable file not found in $PATH"[0m[0m [36magent_id=[0mgemini-1 [36magent_name=[0mGemini
    adapters_test.go:320: gemini CLI not available, skipping test
=== RUN   TestAgentAnnouncement/copilot
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mcopilot CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"copilot\": executable file not found in $PATH"[0m[0m [36magent_id=[0mcopilot-1 [36magent_name=[0mCopilot
    adapters_test.go:320: copilot CLI not available, skipping test
=== RUN   TestAgentAnnouncement/cursor
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mcursor-agent CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"cursor-agent\": executable file not found in $PATH"[0m[0m [36magent_id=[0mcursor-1 [36magent_name=[0mCursor [36magent_type=[0mcursor
    adapters_test.go:320: cursor CLI not available, skipping test
=== RUN   TestAgentAnnouncement/qwen
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mqwen CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"qwen\": executable file not found in $PATH"[0m[0m [36magent_id=[0mqwen-1 [36magent_name=[0mQwen
    adapters_test.go:320: qwen CLI not available, skipping test
=== RUN   TestAgentAnnouncement/codex
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mcodex CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"codex\": executable file not found in $PATH"[0m[0m [36magent_id=[0mcodex-1 [36magent_name=[0mCodex
    adapters_test.go:320: codex CLI not available, skipping test
=== RUN   TestAgentAnnouncement/amp
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mamp CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"amp\": executable file not found in $PATH"[0m[0m [36magent_id=[0mamp-1 [36magent_name=[0mAmp
    adapters_test.go:320: amp CLI not available, skipping test
=== RUN   TestAgentAnnouncement/aider
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1maider CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"aider\": executable file not found in $PATH"[0m[0m [36magent_id=[0maider-1 [36magent_name=[0mAider
    adapters_test.go:320: aider CLI not available, skipping test
--- PASS: TestAgentAnnouncement (0.00s)
    --- SKIP: TestAgentAnnouncement/claude (0.00s)
    --- SKIP: TestAgentAnnouncement/gemini (0.00s)
    --- SKIP: TestAgentAnnouncement/copilot (0.00s)
    --- SKIP: TestAgentAnnouncement/cursor (0.00s)
    --- SKIP: TestAgentAnnouncement/qwen (0.00s)
    --- SKIP: TestAgentAnnouncement/codex (0.00s)
    --- SKIP: TestAgentAnnouncement/amp (0.00s)
    --- SKIP: TestAgentAnnouncement/aider (0.00s)
=== RUN   TestAgentAnnouncementDefault
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mclaude CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"claude\": executable file not found in $PATH"[0m[0m [36magent_id=[0mclaude-1 [36magent_name=[0mClaude
    adapters_test.go:345: claude CLI not available, skipping test
--- SKIP: TestAgentAnnouncementDefault (0.00s)
=== RUN   TestAgentHealthCheckTimeout
=== RUN   TestAgentHealthCheckTimeout/claude
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mclaude CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"claude\": executable file not found in $PATH"[0m[0m [36magent_id=[0mclaude-test [36magent_name=[0mClaude
    adapters_test.go:387: claude CLI not available, skipping test
=== RUN   TestAgentHealthCheckTimeout/gemini
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mgemini CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"gemini\": executable file not found in $PATH"[0m[0m [36magent_id=[0mgemini-test [36magent_name=[0mGemini
    adapters_test.go:387: gemini CLI not available, skipping test
=== RUN   TestAgentHealthCheckTimeout/copilot
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mcopilot CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"copilot\": executable file not found in $PATH"[0m[0m [36magent_id=[0mcopilot-test [36magent_name=[0mCopilot
    adapters_test.go:387: copilot CLI not available, skipping test
=== RUN   TestAgentHealthCheckTimeout/cursor
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mcursor-agent CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"cursor-agent\": executable file not found in $PATH"[0m[0m [36magent_id=[0mcursor-test [36magent_name=[0mCursor [36magent_type=[0mcursor
    adapters_test.go:387: cursor CLI not available, skipping test
=== RUN   TestAgentHealthCheckTimeout/qwen
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mqwen CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"qwen\": executable file not found in $PATH"[0m[0m [36magent_id=[0mqwen-test [36magent_name=[0mQwen
    adapters_test.go:387: qwen CLI not available, skipping test
=== RUN   TestAgentHealthCheckTimeout/codex
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mcodex CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"codex\": executable file not found in $PATH"[0m[0m [36magent_id=[0mcodex-test [36magent_name=[0mCodex
    adapters_test.go:387: codex CLI not available, skipping test
=== RUN   TestAgentHealthCheckTimeout/amp
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mamp CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"amp\": executable file not found in $PATH"[0m[0m [36magent_id=[0mamp-test [36magent_name=[0mAmp
    adapters_test.go:387: amp CLI not available, skipping test
=== RUN   TestAgentHealthCheckTimeout/aider
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1maider CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"aider\": executable file not found in $PATH"[0m[0m [36magent_id=[0maider-test [36magent_name=[0mAider
    adapters_test.go:387: aider CLI not available, skipping test
--- PASS: TestAgentHealthCheckTimeout (0.00s)
    --- SKIP: TestAgentHealthCheckTimeout/claude (0.00s)
    --- SKIP: TestAgentHealthCheckTimeout/gemini (0.00s)
    --- SKIP: TestAgentHealthCheckTimeout/copilot (0.00s)
    --- SKIP: TestAgentHealthCheckTimeout/cursor (0.00s)
    --- SKIP: TestAgentHealthCheckTimeout/qwen (0.00s)
    --- SKIP: TestAgentHealthCheckTimeout/codex (0.00s)
    --- SKIP: TestAgentHealthCheckTimeout/amp (0.00s)
    --- SKIP: TestAgentHealthCheckTimeout/aider (0.00s)
=== RUN   TestAgentGetModel
=== RUN   TestAgentGetModel/claude_with_custom_model
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mclaude CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"claude\": executable file not found in $PATH"[0m[0m [36magent_id=[0mtest-agent [36magent_name=[0mTestAgent
    adapters_test.go:460: CLI not available, skipping test
=== RUN   TestAgentGetModel/gemini_with_custom_model
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mgemini CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"gemini\": executable file not found in $PATH"[0m[0m [36magent_id=[0mtest-agent [36magent_name=[0mTestAgent
    adapters_test.go:460: CLI not available, skipping test
=== RUN   TestAgentGetModel/claude_without_model_falls_back_to_type
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mclaude CLI not found in PATH[0m [36merror=[0m[31m[1m"exec: \"claude\": executable file not found in $PATH"[0m[0m [36magent_id=[0mtest-agent [36magent_name=[0mTestAgent
    adapters_test.go:460: CLI not available, skipping test
--- PASS: TestAgentGetModel (0.00s)
    --- SKIP: TestAgentGetModel/claude_with_custom_model (0.00s)
    --- SKIP: TestAgentGetModel/gemini_with_custom_model (0.00s)
    --- SKIP: TestAgentGetModel/claude_without_model_falls_back_to_type (0.00s)
=== RUN   TestConversationFormatting
=== RUN   TestConversationFormatting/message_count
=== RUN   TestConversationFormatting/message_roles
=== RUN   TestConversationFormatting/message_content
--- PASS: TestConversationFormatting (0.00s)
    --- PASS: TestConversationFormatting/message_count (0.00s)
    --- PASS: TestConversationFormatting/message_roles (0.00s)
    --- PASS: TestConversationFormatting/message_content (0.00s)
=== RUN   TestNewOpenRouterAgent
--- PASS: TestNewOpenRouterAgent (0.00s)
=== RUN   TestOpenRouterAgent_Initialize
=== RUN   TestOpenRouterAgent_Initialize/successful_initialization
[90m2025-10-29T02:57:16Z[0m DBG loaded embedded provider config [36mproviders=[0m16 [36msource=[0membedded [36mversion=[0m1.0
[90m2025-10-29T02:57:16Z[0m [33mWRN[0m [1mmodel not found in provider registry (cost estimates may be inaccurate)[0m [36magent_id=[0mtest-1 [36magent_name=[0m"Test OpenRouter" [36mmodel=[0manthropic/claude-sonnet-4-5
[90m2025-10-29T02:57:16Z[0m [32mINF[0m [1mopenrouter agent initialized successfully[0m [36magent_id=[0mtest-1 [36magent_name=[0m"Test OpenRouter" [36mmodel=[0manthropic/claude-sonnet-4-5
=== RUN   TestOpenRouterAgent_Initialize/missing_api_key
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mOPENROUTER_API_KEY environment variable not set[0m [36magent_id=[0mtest-2 [36magent_name=[0m"Test OpenRouter"
=== RUN   TestOpenRouterAgent_Initialize/missing_model
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mmodel not specified in configuration[0m [36magent_id=[0mtest-3 [36magent_name=[0m"Test OpenRouter"
--- PASS: TestOpenRouterAgent_Initialize (0.02s)
    --- PASS: TestOpenRouterAgent_Initialize/successful_initialization (0.02s)
    --- PASS: TestOpenRouterAgent_Initialize/missing_api_key (0.00s)
    --- PASS: TestOpenRouterAgent_Initialize/missing_model (0.00s)
=== RUN   TestOpenRouterAgent_IsAvailable
=== RUN   TestOpenRouterAgent_IsAvailable/api_key_set
=== RUN   TestOpenRouterAgent_IsAvailable/api_key_not_set
--- PASS: TestOpenRouterAgent_IsAvailable (0.00s)
    --- PASS: TestOpenRouterAgent_IsAvailable/api_key_set (0.00s)
    --- PASS: TestOpenRouterAgent_IsAvailable/api_key_not_set (0.00s)
=== RUN   TestOpenRouterAgent_GetCLIVersion
--- PASS: TestOpenRouterAgent_GetCLIVersion (0.00s)
=== RUN   TestOpenRouterAgent_BuildConversationHistory
[90m2025-10-29T02:57:16Z[0m [33mWRN[0m [1mfound model via fuzzy match - this may not be accurate[0m [36mactual_id=[0mopenai/gpt-3.5-turbo [36mmatch=[0mfuzzy [36mmodel=[0m"OpenAI: GPT-3.5 Turbo" [36mmodel_id=[0mgpt-3.5-turbo [36mprovider=[0mOpenRouter
[90m2025-10-29T02:57:16Z[0m DBG model found in provider registry [36magent_id=[0mtest-agent [36magent_name=[0m"Test Agent" [36mmodel=[0mopenai/gpt-3.5-turbo [36mprovider=[0mOpenRouter
[90m2025-10-29T02:57:16Z[0m [32mINF[0m [1mopenrouter agent initialized successfully[0m [36magent_id=[0mtest-agent [36magent_name=[0m"Test Agent" [36mmodel=[0mgpt-3.5-turbo
--- PASS: TestOpenRouterAgent_BuildConversationHistory (0.00s)
=== RUN   TestOpenRouterAgent_HealthCheck_NotInitialized
[90m2025-10-29T02:57:16Z[0m [31mERR[0m [1mopenrouter health check failed: not initialized[0m [36magent_name=[0m
--- PASS: TestOpenRouterAgent_HealthCheck_NotInitialized (0.00s)
=== RUN   TestOpenRouterAgent_HealthCheck_Integration
    openrouter_test.go:293: OPENROUTER_API_KEY not set, skipping integration test
--- SKIP: TestOpenRouterAgent_HealthCheck_Integration (0.00s)
=== RUN   TestOpenRouterAgent_SendMessage_Integration
    openrouter_test.go:324: OPENROUTER_API_KEY not set, skipping integration test
--- SKIP: TestOpenRouterAgent_SendMessage_Integration (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/adapters	1.049s
=== RUN   TestMessageType
--- PASS: TestMessageType (0.00s)
=== RUN   TestResponseMetrics
--- PASS: TestResponseMetrics (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/agent	1.010s
=== RUN   TestNewOpenAICompatClient
--- PASS: TestNewOpenAICompatClient (0.00s)
=== RUN   TestCreateChatCompletion_Success
[90m2025-10-29T02:57:17Z[0m DBG sending chat completion request [36mmodel=[0mgpt-3.5-turbo [36murl=[0mhttp://127.0.0.1:42535/chat/completions
--- PASS: TestCreateChatCompletion_Success (0.00s)
=== RUN   TestCreateChatCompletion_APIError
[90m2025-10-29T02:57:17Z[0m DBG sending chat completion request [36mmodel=[0minvalid-model [36murl=[0mhttp://127.0.0.1:41169/chat/completions
--- PASS: TestCreateChatCompletion_APIError (0.00s)
=== RUN   TestCreateChatCompletionStream_Success
[90m2025-10-29T02:57:17Z[0m DBG sending streaming chat completion request [36mmodel=[0mgpt-3.5-turbo [36murl=[0mhttp://127.0.0.1:44835/chat/completions
--- PASS: TestCreateChatCompletionStream_Success (0.00s)
=== RUN   TestShouldRetry
=== RUN   TestShouldRetry/nil_error
=== RUN   TestShouldRetry/HTTP_500_error
=== RUN   TestShouldRetry/connection_error
=== RUN   TestShouldRetry/timeout_error
=== RUN   TestShouldRetry/HTTP_400_error
=== RUN   TestShouldRetry/HTTP_401_error
--- PASS: TestShouldRetry (0.00s)
    --- PASS: TestShouldRetry/nil_error (0.00s)
    --- PASS: TestShouldRetry/HTTP_500_error (0.00s)
    --- PASS: TestShouldRetry/connection_error (0.00s)
    --- PASS: TestShouldRetry/timeout_error (0.00s)
    --- PASS: TestShouldRetry/HTTP_400_error (0.00s)
    --- PASS: TestShouldRetry/HTTP_401_error (0.00s)
=== RUN   TestCreateChatCompletion_WithRetry
[90m2025-10-29T02:57:17Z[0m DBG sending chat completion request [36mmodel=[0mgpt-3.5-turbo [36murl=[0mhttp://127.0.0.1:37023/chat/completions
[90m2025-10-29T02:57:17Z[0m DBG retrying chat completion request [36mattempt=[0m1 [36mbackoff=[0m1s
[90m2025-10-29T02:57:18Z[0m DBG sending chat completion request [36mmodel=[0mgpt-3.5-turbo [36murl=[0mhttp://127.0.0.1:37023/chat/completions
[90m2025-10-29T02:57:18Z[0m DBG retrying chat completion request [36mattempt=[0m2 [36mbackoff=[0m2s
[90m2025-10-29T02:57:20Z[0m DBG sending chat completion request [36mmodel=[0mgpt-3.5-turbo [36murl=[0mhttp://127.0.0.1:37023/chat/completions
--- PASS: TestCreateChatCompletion_WithRetry (3.01s)
=== RUN   TestCreateChatCompletion_ContextCancellation
[90m2025-10-29T02:57:20Z[0m DBG sending chat completion request [36mmodel=[0mgpt-3.5-turbo [36murl=[0mhttp://127.0.0.1:36637/chat/completions
--- PASS: TestCreateChatCompletion_ContextCancellation (0.10s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/client	4.132s
=== RUN   TestNewDefaultConfig
--- PASS: TestNewDefaultConfig (0.00s)
=== RUN   TestConfigValidate
=== RUN   TestConfigValidate/empty_agents
=== RUN   TestConfigValidate/duplicate_agent_IDs
=== RUN   TestConfigValidate/invalid_mode
=== RUN   TestConfigValidate/valid_config
--- PASS: TestConfigValidate (0.00s)
    --- PASS: TestConfigValidate/empty_agents (0.00s)
    --- PASS: TestConfigValidate/duplicate_agent_IDs (0.00s)
    --- PASS: TestConfigValidate/invalid_mode (0.00s)
    --- PASS: TestConfigValidate/valid_config (0.00s)
=== RUN   TestNewConfigWatcher
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig watcher initialized[0m [36mconfig_path=[0m/tmp/TestNewConfigWatcher943695271/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstopped watching config file[0m
--- PASS: TestNewConfigWatcher (0.00s)
=== RUN   TestNewConfigWatcher_InvalidFile
--- PASS: TestNewConfigWatcher_InvalidFile (0.00s)
=== RUN   TestConfigWatcher_GetConfig
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig watcher initialized[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_GetConfig648526301/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstopped watching config file[0m
--- PASS: TestConfigWatcher_GetConfig (0.00s)
=== RUN   TestConfigWatcher_OnConfigChange
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig watcher initialized[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_OnConfigChange1190277344/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstarted watching config file for changes[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_OnConfigChange1190277344/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig file change detected[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_OnConfigChange1190277344/001/test-config.yaml [36mevent=[0mWRITE
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig reloaded successfully[0m [36magents=[0m2 [36mconfig_path=[0m/tmp/TestConfigWatcher_OnConfigChange1190277344/001/test-config.yaml [36mmax_turns=[0m10 [36mmode=[0mreactive
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig file change detected[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_OnConfigChange1190277344/001/test-config.yaml [36mevent=[0mWRITE
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig reloaded successfully[0m [36magents=[0m2 [36mconfig_path=[0m/tmp/TestConfigWatcher_OnConfigChange1190277344/001/test-config.yaml [36mmax_turns=[0m10 [36mmode=[0mreactive
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstopped watching config file[0m
==================
WARNING: DATA RACE
Write at 0x00c0002220a0 by goroutine 34:
  github.com/kevinelliott/agentpipe/pkg/config.TestConfigWatcher_OnConfigChange.func1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher_test.go:127 +0x4e
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange.func2()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:145 +0x5c
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange.gowrap1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:146 +0x41

Previous write at 0x00c0002220a0 by goroutine 33:
  github.com/kevinelliott/agentpipe/pkg/config.TestConfigWatcher_OnConfigChange.func1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher_test.go:127 +0x4e
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange.func2()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:145 +0x5c
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange.gowrap1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:146 +0x41

Goroutine 34 (running) created at:
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:139 +0x844
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).StartWatching.func1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:79 +0x88
  github.com/spf13/viper.(*Viper).WatchConfig.func1.1()
      /home/runner/go/pkg/mod/github.com/spf13/viper@v1.21.0/viper.go:363 +0x53b

Goroutine 33 (finished) created at:
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:139 +0x844
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).StartWatching.func1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:79 +0x88
  github.com/spf13/viper.(*Viper).WatchConfig.func1.1()
      /home/runner/go/pkg/mod/github.com/spf13/viper@v1.21.0/viper.go:363 +0x53b
==================
    testing.go:1490: race detected during execution of test
--- FAIL: TestConfigWatcher_OnConfigChange (0.11s)
=== RUN   TestConfigWatcher_MultipleCallbacks
==================
WARNING: DATA RACE
Write at 0x00c0002220a8 by goroutine 34:
  github.com/kevinelliott/agentpipe/pkg/config.TestConfigWatcher_OnConfigChange.func1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher_test.go:128 +0x89
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange.func2()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:145 +0x5c
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange.gowrap1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:146 +0x41

Previous write at 0x00c0002220a8 by goroutine 33:
  github.com/kevinelliott/agentpipe/pkg/config.TestConfigWatcher_OnConfigChange.func1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher_test.go:128 +0x89
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange.func2()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:145 +0x5c
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange.gowrap1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:146 +0x41

Goroutine 34 (running) created at:
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:139 +0x844
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).StartWatching.func1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:79 +0x88
  github.com/spf13/viper.(*Viper).WatchConfig.func1.1()
      /home/runner/go/pkg/mod/github.com/spf13/viper@v1.21.0/viper.go:363 +0x53b

Goroutine 33 (finished) created at:
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).handleConfigChange()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:139 +0x844
  github.com/kevinelliott/agentpipe/pkg/config.(*ConfigWatcher).StartWatching.func1()
      /home/runner/work/agentpipe/agentpipe/pkg/config/watcher.go:79 +0x88
  github.com/spf13/viper.(*Viper).WatchConfig.func1.1()
      /home/runner/go/pkg/mod/github.com/spf13/viper@v1.21.0/viper.go:363 +0x53b
==================
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig watcher initialized[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_MultipleCallbacks2533947116/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstarted watching config file for changes[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_MultipleCallbacks2533947116/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig file change detected[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_MultipleCallbacks2533947116/001/test-config.yaml [36mevent=[0mWRITE
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig reloaded successfully[0m [36magents=[0m1 [36mconfig_path=[0m/tmp/TestConfigWatcher_MultipleCallbacks2533947116/001/test-config.yaml [36mmax_turns=[0m10 [36mmode=[0mround-robin
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstopped watching config file[0m
    testing.go:1490: race detected during execution of test
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig file change detected[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_MultipleCallbacks2533947116/001/test-config.yaml [36mevent=[0mWRITE
--- FAIL: TestConfigWatcher_MultipleCallbacks (0.10s)
=== RUN   TestConfigWatcher_InvalidConfigUpdate
[90m2025-10-29T02:57:18Z[0m [31mERR[0m [1mfailed to reload config[0m [36merror=[0m[31m[1m"failed to read config file: open /tmp/TestConfigWatcher_MultipleCallbacks2533947116/001/test-config.yaml: no such file or directory"[0m[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_MultipleCallbacks2533947116/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig watcher initialized[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_InvalidConfigUpdate3126970452/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstarted watching config file for changes[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_InvalidConfigUpdate3126970452/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig file change detected[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_InvalidConfigUpdate3126970452/001/test-config.yaml [36mevent=[0mWRITE
[90m2025-10-29T02:57:18Z[0m [31mERR[0m [1mfailed to reload config[0m [36merror=[0m[31m[1m"invalid configuration: at least one agent must be configured"[0m[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_InvalidConfigUpdate3126970452/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig file change detected[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_InvalidConfigUpdate3126970452/001/test-config.yaml [36mevent=[0mWRITE
[90m2025-10-29T02:57:18Z[0m [31mERR[0m [1mfailed to reload config[0m [36merror=[0m[31m[1m"invalid configuration: at least one agent must be configured"[0m[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_InvalidConfigUpdate3126970452/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstopped watching config file[0m
--- PASS: TestConfigWatcher_InvalidConfigUpdate (0.60s)
=== RUN   TestConfigWatcher_StopWatching
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig watcher initialized[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_StopWatching2442327640/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstarted watching config file for changes[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_StopWatching2442327640/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstopped watching config file[0m
--- PASS: TestConfigWatcher_StopWatching (0.10s)
=== RUN   TestConfigWatcher_ConcurrentReads
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mconfig watcher initialized[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_ConcurrentReads884153743/001/test-config.yaml
[90m2025-10-29T02:57:18Z[0m [32mINF[0m [1mstarted watching config file for changes[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_ConcurrentReads884153743/001/test-config.yaml
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mconfig file change detected[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_ConcurrentReads884153743/001/test-config.yaml [36mevent=[0mWRITE
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mconfig reloaded successfully[0m [36magents=[0m1 [36mconfig_path=[0m/tmp/TestConfigWatcher_ConcurrentReads884153743/001/test-config.yaml [36mmax_turns=[0m10 [36mmode=[0mround-robin
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mconfig file change detected[0m [36mconfig_path=[0m/tmp/TestConfigWatcher_ConcurrentReads884153743/001/test-config.yaml [36mevent=[0mWRITE
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mconfig reloaded successfully[0m [36magents=[0m1 [36mconfig_path=[0m/tmp/TestConfigWatcher_ConcurrentReads884153743/001/test-config.yaml [36mmax_turns=[0m10 [36mmode=[0mround-robin
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mstopped watching config file[0m
--- PASS: TestConfigWatcher_ConcurrentReads (0.20s)
FAIL
FAIL	github.com/kevinelliott/agentpipe/pkg/config	1.132s
=== RUN   TestNewState
--- PASS: TestNewState (0.00s)
=== RUN   TestState_Save
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mconversation state saved[0m [36mfile_size=[0m1359 [36mmessages=[0m1 [36mpath=[0m/tmp/TestState_Save1986031455/001/test-state.json [36mtotal_turns=[0m1
--- PASS: TestState_Save (0.00s)
=== RUN   TestState_Save_CreatesDirectory
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mconversation state saved[0m [36mfile_size=[0m1049 [36mmessages=[0m1 [36mpath=[0m/tmp/TestState_Save_CreatesDirectory2909663405/001/nested/dir/state.json [36mtotal_turns=[0m1
--- PASS: TestState_Save_CreatesDirectory (0.00s)
=== RUN   TestLoadState
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mconversation state saved[0m [36mfile_size=[0m1897 [36mmessages=[0m2 [36mpath=[0m/tmp/TestLoadState3133744748/001/test-state.json [36mtotal_turns=[0m2
[90m2025-10-29T02:57:19Z[0m DBG loading conversation state [36mpath=[0m/tmp/TestLoadState3133744748/001/test-state.json
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mconversation state loaded[0m [36mmessages=[0m2 [36mpath=[0m/tmp/TestLoadState3133744748/001/test-state.json [36msaved_at=[0m2025-10-29T02:57:19.546511612Z [36mstarted_at=[0m2025-10-29T02:47:19.546511231Z [36mtotal_turns=[0m2 [36mversion=[0m1.0
--- PASS: TestLoadState (0.00s)
=== RUN   TestLoadState_NonexistentFile
[90m2025-10-29T02:57:19Z[0m DBG loading conversation state [36mpath=[0m/nonexistent/path/state.json
[90m2025-10-29T02:57:19Z[0m [31mERR[0m [1mfailed to read state file[0m [36merror=[0m[31m[1m"open /nonexistent/path/state.json: no such file or directory"[0m[0m [36mpath=[0m/nonexistent/path/state.json
--- PASS: TestLoadState_NonexistentFile (0.00s)
=== RUN   TestLoadState_InvalidJSON
[90m2025-10-29T02:57:19Z[0m DBG loading conversation state [36mpath=[0m/tmp/TestLoadState_InvalidJSON1042073765/001/invalid.json
[90m2025-10-29T02:57:19Z[0m [31mERR[0m [1mfailed to parse state file[0m [36merror=[0m[31m[1m"invalid character 'o' in literal null (expecting 'u')"[0m[0m [36mpath=[0m/tmp/TestLoadState_InvalidJSON1042073765/001/invalid.json
--- PASS: TestLoadState_InvalidJSON (0.00s)
=== RUN   TestGenerateStateFileName
--- PASS: TestGenerateStateFileName (0.00s)
=== RUN   TestListStates
[90m2025-10-29T02:57:19Z[0m [32mINF[0m [1mconversation state saved[0m [36mfile_size=[0m1045 [36mmessages=[0m1 [36mpath=[0m/tmp/TestListStates247536641/001/conversation-20251029-025719.json [36mtotal_turns=[0m1
[90m2025-10-29T02:57:20Z[0m [32mINF[0m [1mconversation state saved[0m [36mfile_size=[0m1045 [36mmessages=[0m1 [36mpath=[0m/tmp/TestListStates247536641/001/conversation-20251029-025720.json [36mtotal_turns=[0m1
[90m2025-10-29T02:57:21Z[0m [32mINF[0m [1mconversation state saved[0m [36mfile_size=[0m1045 [36mmessages=[0m1 [36mpath=[0m/tmp/TestListStates247536641/001/conversation-20251029-025721.json [36mtotal_turns=[0m1
--- PASS: TestListStates (3.00s)
=== RUN   TestListStates_EmptyDirectory
--- PASS: TestListStates_EmptyDirectory (0.00s)
=== RUN   TestListStates_NonexistentDirectory
--- PASS: TestListStates_NonexistentDirectory (0.00s)
=== RUN   TestGetStateInfo
[90m2025-10-29T02:57:22Z[0m [32mINF[0m [1mconversation state saved[0m [36mfile_size=[0m2074 [36mmessages=[0m3 [36mpath=[0m/tmp/TestGetStateInfo3143897591/001/test-state.json [36mtotal_turns=[0m3
[90m2025-10-29T02:57:22Z[0m DBG loading conversation state [36mpath=[0m/tmp/TestGetStateInfo3143897591/001/test-state.json
[90m2025-10-29T02:57:22Z[0m [32mINF[0m [1mconversation state loaded[0m [36mmessages=[0m3 [36mpath=[0m/tmp/TestGetStateInfo3143897591/001/test-state.json [36msaved_at=[0m2025-10-29T02:57:22.552643221Z [36mstarted_at=[0m2025-10-29T02:42:22.55264263Z [36mtotal_turns=[0m3 [36mversion=[0m1.0
--- PASS: TestGetStateInfo (0.00s)
=== RUN   TestGetDefaultStateDir
--- PASS: TestGetDefaultStateDir (0.00s)
=== RUN   TestState_RoundTrip
[90m2025-10-29T02:57:22Z[0m [32mINF[0m [1mconversation state saved[0m [36mfile_size=[0m5906 [36mmessages=[0m20 [36mpath=[0m/tmp/TestState_RoundTrip548520983/001/roundtrip.json [36mtotal_turns=[0m20
[90m2025-10-29T02:57:22Z[0m DBG loading conversation state [36mpath=[0m/tmp/TestState_RoundTrip548520983/001/roundtrip.json
[90m2025-10-29T02:57:22Z[0m [32mINF[0m [1mconversation state loaded[0m [36mmessages=[0m20 [36mpath=[0m/tmp/TestState_RoundTrip548520983/001/roundtrip.json [36msaved_at=[0m2025-10-29T02:57:22.554460327Z [36mstarted_at=[0m2025-10-29T02:27:22.554459936Z [36mtotal_turns=[0m20 [36mversion=[0m1.0
--- PASS: TestState_RoundTrip (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/conversation	4.023s
=== RUN   TestAgentError
--- PASS: TestAgentError (0.00s)
=== RUN   TestConfigError
=== RUN   TestConfigError/with_field
=== RUN   TestConfigError/without_field
=== RUN   TestConfigError/with_cause
--- PASS: TestConfigError (0.00s)
    --- PASS: TestConfigError/with_field (0.00s)
    --- PASS: TestConfigError/without_field (0.00s)
    --- PASS: TestConfigError/with_cause (0.00s)
=== RUN   TestInitializationError
=== RUN   TestInitializationError/with_underlying_error
=== RUN   TestInitializationError/without_underlying_error
--- PASS: TestInitializationError (0.00s)
    --- PASS: TestInitializationError/with_underlying_error (0.00s)
    --- PASS: TestInitializationError/without_underlying_error (0.00s)
=== RUN   TestCommunicationError
=== RUN   TestCommunicationError/with_agent_name
=== RUN   TestCommunicationError/without_agent_name
--- PASS: TestCommunicationError (0.00s)
    --- PASS: TestCommunicationError/with_agent_name (0.00s)
    --- PASS: TestCommunicationError/without_agent_name (0.00s)
=== RUN   TestValidationError
=== RUN   TestValidationError/with_value
=== RUN   TestValidationError/without_value
--- PASS: TestValidationError (0.00s)
    --- PASS: TestValidationError/with_value (0.00s)
    --- PASS: TestValidationError/without_value (0.00s)
=== RUN   TestOrchestratorError
=== RUN   TestOrchestratorError/with_turn_number
=== RUN   TestOrchestratorError/without_turn_number
--- PASS: TestOrchestratorError (0.00s)
    --- PASS: TestOrchestratorError/with_turn_number (0.00s)
    --- PASS: TestOrchestratorError/without_turn_number (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/errors	1.009s
=== RUN   TestExportJSON
--- PASS: TestExportJSON (0.00s)
=== RUN   TestExportMarkdown
--- PASS: TestExportMarkdown (0.00s)
=== RUN   TestExportHTML
--- PASS: TestExportHTML (0.00s)
=== RUN   TestExportWithoutMetrics
--- PASS: TestExportWithoutMetrics (0.00s)
=== RUN   TestExportWithoutTimestamps
--- PASS: TestExportWithoutTimestamps (0.00s)
=== RUN   TestExportUnsupportedFormat
--- PASS: TestExportUnsupportedFormat (0.00s)
=== RUN   TestCalculateSummary
--- PASS: TestCalculateSummary (0.00s)
=== RUN   TestExportEmptyMessages
--- PASS: TestExportEmptyMessages (0.00s)
=== RUN   TestHTMLSpecialCharacters
--- PASS: TestHTMLSpecialCharacters (0.00s)
=== RUN   TestMarkdownMultipleAgents
--- PASS: TestMarkdownMultipleAgents (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/export	1.010s
=== RUN   TestNew
--- PASS: TestNew (0.00s)
=== RUN   TestNewWithLevel
--- PASS: TestNewWithLevel (0.00s)
=== RUN   TestLogLevels
=== RUN   TestLogLevels/Debug
=== RUN   TestLogLevels/Info
=== RUN   TestLogLevels/Warn
=== RUN   TestLogLevels/Error
--- PASS: TestLogLevels (0.00s)
    --- PASS: TestLogLevels/Debug (0.00s)
    --- PASS: TestLogLevels/Info (0.00s)
    --- PASS: TestLogLevels/Warn (0.00s)
    --- PASS: TestLogLevels/Error (0.00s)
=== RUN   TestLogFormattedMessages
=== RUN   TestLogFormattedMessages/Debugf
=== RUN   TestLogFormattedMessages/Infof
=== RUN   TestLogFormattedMessages/Warnf
=== RUN   TestLogFormattedMessages/Errorf
--- PASS: TestLogFormattedMessages (0.00s)
    --- PASS: TestLogFormattedMessages/Debugf (0.00s)
    --- PASS: TestLogFormattedMessages/Infof (0.00s)
    --- PASS: TestLogFormattedMessages/Warnf (0.00s)
    --- PASS: TestLogFormattedMessages/Errorf (0.00s)
=== RUN   TestWithField
--- PASS: TestWithField (0.00s)
=== RUN   TestWithFields
--- PASS: TestWithFields (0.00s)
=== RUN   TestWithError
--- PASS: TestWithError (0.00s)
=== RUN   TestGlobalLogger
--- PASS: TestGlobalLogger (0.00s)
=== RUN   TestParseLevel
=== RUN   TestParseLevel/trace
=== RUN   TestParseLevel/debug
=== RUN   TestParseLevel/info
=== RUN   TestParseLevel/warn
=== RUN   TestParseLevel/warning
=== RUN   TestParseLevel/error
=== RUN   TestParseLevel/fatal
=== RUN   TestParseLevel/panic
=== RUN   TestParseLevel/unknown
--- PASS: TestParseLevel (0.00s)
    --- PASS: TestParseLevel/trace (0.00s)
    --- PASS: TestParseLevel/debug (0.00s)
    --- PASS: TestParseLevel/info (0.00s)
    --- PASS: TestParseLevel/warn (0.00s)
    --- PASS: TestParseLevel/warning (0.00s)
    --- PASS: TestParseLevel/error (0.00s)
    --- PASS: TestParseLevel/fatal (0.00s)
    --- PASS: TestParseLevel/panic (0.00s)
    --- PASS: TestParseLevel/unknown (0.00s)
=== RUN   TestInitLogger
--- PASS: TestInitLogger (0.00s)
=== RUN   TestChainedContext
--- PASS: TestChainedContext (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/log	1.013s
=== RUN   TestNewChatLoggerWithoutLogDir
--- PASS: TestNewChatLoggerWithoutLogDir (0.00s)
=== RUN   TestNewChatLoggerWithLogDir
--- PASS: TestNewChatLoggerWithLogDir (0.01s)
=== RUN   TestNewChatLoggerJSONFormat
--- PASS: TestNewChatLoggerJSONFormat (0.00s)
=== RUN   TestLogMessageToFile
--- PASS: TestLogMessageToFile (0.00s)
=== RUN   TestLogMessageToFileJSON
--- PASS: TestLogMessageToFileJSON (0.00s)
=== RUN   TestLogMessageToConsole
--- PASS: TestLogMessageToConsole (0.00s)
=== RUN   TestLogMessageWithMetrics
--- PASS: TestLogMessageWithMetrics (0.00s)
=== RUN   TestLogMessageSystemRole
--- PASS: TestLogMessageSystemRole (0.00s)
=== RUN   TestLogError
--- PASS: TestLogError (0.00s)
=== RUN   TestLogSystem
--- PASS: TestLogSystem (0.00s)
=== RUN   TestGetAgentColor
--- PASS: TestGetAgentColor (0.00s)
=== RUN   TestGetAgentBadgeStyle
--- PASS: TestGetAgentBadgeStyle (0.00s)
=== RUN   TestWrapText
=== RUN   TestWrapText/short_text
=== RUN   TestWrapText/long_text
=== RUN   TestWrapText/multiline_text
--- PASS: TestWrapText (0.00s)
    --- PASS: TestWrapText/short_text (0.00s)
    --- PASS: TestWrapText/long_text (0.00s)
    --- PASS: TestWrapText/multiline_text (0.00s)
=== RUN   TestWrapTextZeroWidth
--- PASS: TestWrapTextZeroWidth (0.00s)
=== RUN   TestClose
--- PASS: TestClose (0.00s)
=== RUN   TestColorCycling
--- PASS: TestColorCycling (0.00s)
=== RUN   TestLoggerWithNilConsole
--- PASS: TestLoggerWithNilConsole (0.00s)
=== RUN   TestMinFunction
--- PASS: TestMinFunction (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/logger	1.040s
=== RUN   TestNewMetrics
--- PASS: TestNewMetrics (0.00s)
=== RUN   TestNewMetrics_NilRegistry
--- PASS: TestNewMetrics_NilRegistry (0.00s)
=== RUN   TestRecordAgentRequest
--- PASS: TestRecordAgentRequest (0.00s)
=== RUN   TestRecordAgentDuration
--- PASS: TestRecordAgentDuration (0.00s)
=== RUN   TestRecordAgentTokens
--- PASS: TestRecordAgentTokens (0.00s)
=== RUN   TestRecordAgentCost
--- PASS: TestRecordAgentCost (0.00s)
=== RUN   TestRecordAgentError
--- PASS: TestRecordAgentError (0.00s)
=== RUN   TestActiveConversations
--- PASS: TestActiveConversations (0.00s)
=== RUN   TestRecordConversationTurn
--- PASS: TestRecordConversationTurn (0.00s)
=== RUN   TestRecordMessageSize
--- PASS: TestRecordMessageSize (0.00s)
=== RUN   TestRecordRetryAttempt
--- PASS: TestRecordRetryAttempt (0.00s)
=== RUN   TestRecordRateLimitHit
--- PASS: TestRecordRateLimitHit (0.00s)
=== RUN   TestReset
--- PASS: TestReset (0.00s)
=== RUN   TestDefaultMetrics
--- PASS: TestDefaultMetrics (0.00s)
=== RUN   TestMetrics_MultipleAgents
--- PASS: TestMetrics_MultipleAgents (0.00s)
=== RUN   TestMetrics_LargeValues
--- PASS: TestMetrics_LargeValues (0.00s)
=== RUN   TestMetrics_ConcurrentAccess
--- PASS: TestMetrics_ConcurrentAccess (0.00s)
=== RUN   TestNewServer
--- PASS: TestNewServer (0.00s)
=== RUN   TestNewServer_Defaults
--- PASS: TestNewServer_Defaults (0.00s)
=== RUN   TestNewServer_CustomRegistry
--- PASS: TestNewServer_CustomRegistry (0.00s)
=== RUN   TestServer_GetMetrics
--- PASS: TestServer_GetMetrics (0.00s)
=== RUN   TestServer_Endpoints
[90m2025-10-29T02:57:23Z[0m [32mINF[0m [1mstarting metrics server[0m [36maddr=[0m:0
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstopping metrics server[0m
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mmetrics server stopped[0m
--- PASS: TestServer_Endpoints (0.10s)
=== RUN   TestServer_MetricsEndpoint
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstarting metrics server[0m [36maddr=[0m:19091
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstopping metrics server[0m
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mmetrics server stopped[0m
--- PASS: TestServer_MetricsEndpoint (0.11s)
=== RUN   TestServer_HealthEndpoint
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstarting metrics server[0m [36maddr=[0m:19092
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstopping metrics server[0m
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mmetrics server stopped[0m
--- PASS: TestServer_HealthEndpoint (0.10s)
=== RUN   TestServer_IndexEndpoint
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstarting metrics server[0m [36maddr=[0m:19093
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstopping metrics server[0m
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mmetrics server stopped[0m
--- PASS: TestServer_IndexEndpoint (0.10s)
=== RUN   TestServer_StopWithoutStart
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstopping metrics server[0m
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mmetrics server stopped[0m
--- PASS: TestServer_StopWithoutStart (0.00s)
=== RUN   TestServer_GracefulShutdown
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstarting metrics server[0m [36maddr=[0m:19095
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstopping metrics server[0m
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mmetrics server stopped[0m
--- PASS: TestServer_GracefulShutdown (0.10s)
=== RUN   TestServer_CustomTimeouts
--- PASS: TestServer_CustomTimeouts (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/metrics	1.554s
=== RUN   TestLoggingMiddleware
[90m2025-10-29T02:57:24Z[0m DBG processing message [36magent_id=[0mtest-agent [36magent_name=[0mTestAgent [36mcontent_len=[0m12 [36mrole=[0muser [36mturn_number=[0m1
[90m2025-10-29T02:57:24Z[0m DBG message processed successfully [36magent_id=[0mtest-agent [36magent_name=[0mTestAgent [36mduration_ms=[0m0 [36mturn_number=[0m1
--- PASS: TestLoggingMiddleware (0.00s)
=== RUN   TestMetricsMiddleware
--- PASS: TestMetricsMiddleware (0.00s)
=== RUN   TestContentFilterMiddleware_MaxLength
--- PASS: TestContentFilterMiddleware_MaxLength (0.00s)
=== RUN   TestContentFilterMiddleware_MinLength
--- PASS: TestContentFilterMiddleware_MinLength (0.00s)
=== RUN   TestContentFilterMiddleware_BlockedWords
--- PASS: TestContentFilterMiddleware_BlockedWords (0.00s)
=== RUN   TestContentFilterMiddleware_RequiredWords
--- PASS: TestContentFilterMiddleware_RequiredWords (0.00s)
=== RUN   TestSanitizationMiddleware
=== RUN   TestSanitizationMiddleware/trim_whitespace
=== RUN   TestSanitizationMiddleware/collapse_multiple_spaces
=== RUN   TestSanitizationMiddleware/remove_special_chars
=== RUN   TestSanitizationMiddleware/keep_basic_punctuation
--- PASS: TestSanitizationMiddleware (0.00s)
    --- PASS: TestSanitizationMiddleware/trim_whitespace (0.00s)
    --- PASS: TestSanitizationMiddleware/collapse_multiple_spaces (0.00s)
    --- PASS: TestSanitizationMiddleware/remove_special_chars (0.00s)
    --- PASS: TestSanitizationMiddleware/keep_basic_punctuation (0.00s)
=== RUN   TestRoleValidationMiddleware
[90m2025-10-29T02:57:24Z[0m [31mERR[0m [1mmessage validation failed[0m [36merror=[0m[31m[1m"invalid message role 'invalid', allowed roles: [user assistant system]"[0m[0m [36magent_id=[0mtest [36mmiddleware=[0mrole-validation [36mturn_number=[0m0
--- PASS: TestRoleValidationMiddleware (0.00s)
=== RUN   TestEmptyContentValidationMiddleware
[90m2025-10-29T02:57:24Z[0m [31mERR[0m [1mmessage validation failed[0m [36merror=[0m[31m[1m"message content cannot be empty"[0m[0m [36magent_id=[0mtest [36mmiddleware=[0mempty-content [36mturn_number=[0m0
[90m2025-10-29T02:57:24Z[0m [31mERR[0m [1mmessage validation failed[0m [36merror=[0m[31m[1m"message content cannot be empty"[0m[0m [36magent_id=[0mtest [36mmiddleware=[0mempty-content [36mturn_number=[0m0
--- PASS: TestEmptyContentValidationMiddleware (0.00s)
=== RUN   TestContextEnrichmentMiddleware
--- PASS: TestContextEnrichmentMiddleware (0.00s)
=== RUN   TestRateLimitMiddleware
--- PASS: TestRateLimitMiddleware (0.00s)
=== RUN   TestMessageHistoryMiddleware
--- PASS: TestMessageHistoryMiddleware (0.00s)
=== RUN   TestErrorRecoveryMiddleware
[90m2025-10-29T02:57:24Z[0m [31mERR[0m [1mmiddleware panic recovered[0m [36magent_id=[0mtest [36magent_name=[0m [36mpanic=[0m"test panic"
--- PASS: TestErrorRecoveryMiddleware (0.00s)
=== RUN   TestBuiltinMiddleware_Integration
[90m2025-10-29T02:57:24Z[0m DBG processing message [36magent_id=[0mtest-agent [36magent_name=[0mTestAgent [36mcontent_len=[0m15 [36mrole=[0muser [36mturn_number=[0m1
[90m2025-10-29T02:57:24Z[0m DBG message processed successfully [36magent_id=[0mtest-agent [36magent_name=[0mTestAgent [36mduration_ms=[0m0 [36mturn_number=[0m1
--- PASS: TestBuiltinMiddleware_Integration (0.00s)
=== RUN   TestNewChain
--- PASS: TestNewChain (0.00s)
=== RUN   TestChain_Add
--- PASS: TestChain_Add (0.00s)
=== RUN   TestChain_Process_EmptyChain
--- PASS: TestChain_Process_EmptyChain (0.00s)
=== RUN   TestChain_Process_ExecutionOrder
--- PASS: TestChain_Process_ExecutionOrder (0.00s)
=== RUN   TestTransformMiddleware
--- PASS: TestTransformMiddleware (0.00s)
=== RUN   TestTransformMiddleware_Error
--- PASS: TestTransformMiddleware_Error (0.00s)
=== RUN   TestFilterMiddleware
[90m2025-10-29T02:57:24Z[0m [33mWRN[0m [1mmessage filtered by middleware[0m [36magent_id=[0mtest [36mmiddleware=[0mlength-filter [36mturn_number=[0m0
--- PASS: TestFilterMiddleware (0.00s)
=== RUN   TestFilterMiddleware_Error
--- PASS: TestFilterMiddleware_Error (0.00s)
=== RUN   TestValidationMiddleware
[90m2025-10-29T02:57:24Z[0m [31mERR[0m [1mmessage validation failed[0m [36merror=[0m[31m[1m"content is required"[0m[0m [36magent_id=[0mtest [36mmiddleware=[0mcontent-required [36mturn_number=[0m0
--- PASS: TestValidationMiddleware (0.00s)
=== RUN   TestMiddlewareFunc_Name
--- PASS: TestMiddlewareFunc_Name (0.00s)
=== RUN   TestChain_Process_MultipleTransforms
--- PASS: TestChain_Process_MultipleTransforms (0.00s)
=== RUN   TestChain_Process_ErrorPropagation
--- PASS: TestChain_Process_ErrorPropagation (0.00s)
=== RUN   TestChain_Process_MetadataAccess
--- PASS: TestChain_Process_MetadataAccess (0.00s)
=== RUN   TestChain_Process_ContextCancellation
--- PASS: TestChain_Process_ContextCancellation (0.00s)
=== RUN   TestChain_Process_Concurrent
--- PASS: TestChain_Process_Concurrent (0.00s)
=== RUN   TestChain_Process_MessageModification
--- PASS: TestChain_Process_MessageModification (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/middleware	1.015s
=== RUN   TestNewOrchestrator
--- PASS: TestNewOrchestrator (0.00s)
=== RUN   TestNewOrchestratorDefaults
--- PASS: TestNewOrchestratorDefaults (0.00s)
=== RUN   TestAddAgent
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mtest-1 [36magent_name=[0mTestAgent [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
--- PASS: TestAddAgent (0.00s)
=== RUN   TestRoundRobinMode
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-2 [36magent_name=[0mAgent2 [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m2 [36mhas_prompt=[0mfalse [36mmax_turns=[0m2 [36mmode=[0mround-robin
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m8 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"3.987µs"
[90m2025-10-29T02:57:24Z[0m DBG loaded embedded provider config [36mproviders=[0m16 [36msource=[0membedded [36mversion=[0m1.0
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000024 [36minput_tokens=[0m8 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000084
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.000084 [36mduration_ms=[0m0 [36minput_tokens=[0m8 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m12
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-2 [36magent_name=[0mAgent2 [36minput_tokens=[0m13 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent2 [36mattempt=[0m1 [36mduration=[0m"8.776µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000039 [36minput_tokens=[0m13 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000099
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent2 [36mcost=[0m0.000099 [36mduration_ms=[0m0 [36minput_tokens=[0m13 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m17
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m17 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"4.939µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000051 [36minput_tokens=[0m17 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.00011099999999999999
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.00011099999999999999 [36mduration_ms=[0m0 [36minput_tokens=[0m17 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m21
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-2 [36magent_name=[0mAgent2 [36minput_tokens=[0m22 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent2 [36mattempt=[0m1 [36mduration=[0m"4.609µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000066 [36minput_tokens=[0m22 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000126
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent2 [36mcost=[0m0.000126 [36mduration_ms=[0m0 [36minput_tokens=[0m22 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m26
--- PASS: TestRoundRobinMode (0.06s)
=== RUN   TestReactiveMode
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-2 [36magent_name=[0mAgent2 [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m2 [36mhas_prompt=[0mfalse [36mmax_turns=[0m3 [36mmode=[0mreactive
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-2 [36magent_name=[0mAgent2 [36minput_tokens=[0m8 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent2 [36mattempt=[0m1 [36mduration=[0m"5.249µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000024 [36minput_tokens=[0m8 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000084
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent2 [36mcost=[0m0.000084 [36mduration_ms=[0m0 [36minput_tokens=[0m8 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m12
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m13 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"5.169µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000039 [36minput_tokens=[0m13 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000099
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.000099 [36mduration_ms=[0m0 [36minput_tokens=[0m13 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m17
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-2 [36magent_name=[0mAgent2 [36minput_tokens=[0m17 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent2 [36mattempt=[0m1 [36mduration=[0m"5.591µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000051 [36minput_tokens=[0m17 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.00011099999999999999
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent2 [36mcost=[0m0.00011099999999999999 [36mduration_ms=[0m0 [36minput_tokens=[0m17 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m21
--- PASS: TestReactiveMode (0.03s)
=== RUN   TestContextCancellation
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m100 [36mmode=[0mround-robin
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m4 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"4.318µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000012 [36minput_tokens=[0m4 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000027
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.000027 [36mduration_ms=[0m0 [36minput_tokens=[0m4 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m5
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m5 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"7.824µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000015000000000000002 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.00003
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.00003 [36mduration_ms=[0m0 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m6
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m7 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"4.999µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000021 [36minput_tokens=[0m7 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000035999999999999994
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.000035999999999999994 [36mduration_ms=[0m0 [36minput_tokens=[0m7 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m8
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m9 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"8.796µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000027 [36minput_tokens=[0m9 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000042
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.000042 [36mduration_ms=[0m0 [36minput_tokens=[0m9 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m10
--- PASS: TestContextCancellation (0.21s)
=== RUN   TestAgentTimeout
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mslow-agent [36magent_name=[0mSlowAgent [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0mslow-agent [36magent_name=[0mSlowAgent [36minput_tokens=[0m4 [36mmax_retries=[0m0
[90m2025-10-29T02:57:24Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"context deadline exceeded"[0m[0m [36magent_name=[0mSlowAgent [36mattempt=[0m1 [36mmax_retries=[0m1
[90m2025-10-29T02:57:24Z[0m [31mERR[0m [1mall agent request attempts failed[0m [36merror=[0m[31m[1m"context deadline exceeded"[0m[0m [36magent_name=[0mSlowAgent [36mattempts=[0m1
--- PASS: TestAgentTimeout (0.11s)
=== RUN   TestNoAgentsConfigured
[90m2025-10-29T02:57:24Z[0m [31mERR[0m [1mconversation start failed: no agents configured[0m
--- PASS: TestNoAgentsConfigured (0.00s)
=== RUN   TestInitialPrompt
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mtrue [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:24Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m10 [36mmax_retries=[0m3
[90m2025-10-29T02:57:24Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"7.233µs"
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:24Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000030000000000000004 [36minput_tokens=[0m10 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000045
[90m2025-10-29T02:57:24Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.000045 [36mduration_ms=[0m0 [36minput_tokens=[0m10 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m11
--- PASS: TestInitialPrompt (1.00s)
=== RUN   TestAgentError
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mfailing-agent [36magent_name=[0mFailingAgent [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mworking-agent [36magent_name=[0mWorkingAgent [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m2 [36mhas_prompt=[0mfalse [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:25Z[0m DBG requesting agent response [36magent_id=[0mfailing-agent [36magent_name=[0mFailingAgent [36minput_tokens=[0m10 [36mmax_retries=[0m0
[90m2025-10-29T02:57:25Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"simulated error"[0m[0m [36magent_name=[0mFailingAgent [36mattempt=[0m1 [36mmax_retries=[0m1
[90m2025-10-29T02:57:25Z[0m [31mERR[0m [1mall agent request attempts failed[0m [36merror=[0m[31m[1m"simulated error"[0m[0m [36magent_name=[0mFailingAgent [36mattempts=[0m1
[90m2025-10-29T02:57:25Z[0m DBG requesting agent response [36magent_id=[0mworking-agent [36magent_name=[0mWorkingAgent [36minput_tokens=[0m10 [36mmax_retries=[0m0
[90m2025-10-29T02:57:25Z[0m DBG agent response received [36magent_name=[0mWorkingAgent [36mattempt=[0m1 [36mduration=[0m"6.623µs"
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:25Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000030000000000000004 [36minput_tokens=[0m10 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.00008999999999999999
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mWorkingAgent [36mcost=[0m0.00008999999999999999 [36mduration_ms=[0m0 [36minput_tokens=[0m10 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m14
--- PASS: TestAgentError (0.02s)
=== RUN   TestSelectNextAgent
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36magent_type=[0m [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-2 [36magent_name=[0mAgent2 [36magent_type=[0m [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-3 [36magent_name=[0mAgent3 [36magent_type=[0m [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36magent_type=[0m [36mburst=[0m0 [36mrate_limit=[0m0
--- PASS: TestSelectNextAgent (0.00s)
=== RUN   TestRetrySuccessAfterFailures
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mretry-agent [36magent_name=[0mRetryAgent [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:25Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:25Z[0m DBG requesting agent response [36magent_id=[0mretry-agent [36magent_name=[0mRetryAgent [36minput_tokens=[0m4 [36mmax_retries=[0m3
[90m2025-10-29T02:57:25Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"simulated failure"[0m[0m [36magent_name=[0mRetryAgent [36mattempt=[0m1 [36mmax_retries=[0m4
[90m2025-10-29T02:57:25Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mRetryAgent [36mattempt=[0m1 [36mdelay=[0m100ms [36mmax_retries=[0m3
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"simulated failure"[0m[0m [36magent_name=[0mRetryAgent [36mattempt=[0m2 [36mmax_retries=[0m4
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mRetryAgent [36mattempt=[0m2 [36mdelay=[0m200ms [36mmax_retries=[0m3
[90m2025-10-29T02:57:26Z[0m DBG agent response received [36magent_name=[0mRetryAgent [36mattempt=[0m3 [36mduration=[0m"12.323µs"
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:26Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000012 [36minput_tokens=[0m4 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.00007199999999999999
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mRetryAgent [36mcost=[0m0.00007199999999999999 [36mduration_ms=[0m0 [36minput_tokens=[0m4 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m8
--- PASS: TestRetrySuccessAfterFailures (0.32s)
=== RUN   TestRetryExhaustion
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mfailing-agent [36magent_name=[0mFailingAgent [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:26Z[0m DBG requesting agent response [36magent_id=[0mfailing-agent [36magent_name=[0mFailingAgent [36minput_tokens=[0m5 [36mmax_retries=[0m2
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"persistent failure"[0m[0m [36magent_name=[0mFailingAgent [36mattempt=[0m1 [36mmax_retries=[0m3
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mFailingAgent [36mattempt=[0m1 [36mdelay=[0m100ms [36mmax_retries=[0m2
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"persistent failure"[0m[0m [36magent_name=[0mFailingAgent [36mattempt=[0m2 [36mmax_retries=[0m3
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mFailingAgent [36mattempt=[0m2 [36mdelay=[0m200ms [36mmax_retries=[0m2
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"persistent failure"[0m[0m [36magent_name=[0mFailingAgent [36mattempt=[0m3 [36mmax_retries=[0m3
[90m2025-10-29T02:57:26Z[0m [31mERR[0m [1mall agent request attempts failed[0m [36merror=[0m[31m[1m"persistent failure"[0m[0m [36magent_name=[0mFailingAgent [36mattempts=[0m3
--- PASS: TestRetryExhaustion (0.31s)
=== RUN   TestCalculateBackoffDelay
=== RUN   TestCalculateBackoffDelay/first_retry:_1s_*_2^1_=_2s
=== RUN   TestCalculateBackoffDelay/second_retry:_1s_*_2^2_=_4s
=== RUN   TestCalculateBackoffDelay/third_retry:_1s_*_2^3_=_8s
=== RUN   TestCalculateBackoffDelay/fourth_retry:_1s_*_2^4_=_16s
=== RUN   TestCalculateBackoffDelay/fifth_retry:_capped_at_max_30s
=== RUN   TestCalculateBackoffDelay/large_retry:_capped_at_max_30s
--- PASS: TestCalculateBackoffDelay (0.00s)
    --- PASS: TestCalculateBackoffDelay/first_retry:_1s_*_2^1_=_2s (0.00s)
    --- PASS: TestCalculateBackoffDelay/second_retry:_1s_*_2^2_=_4s (0.00s)
    --- PASS: TestCalculateBackoffDelay/third_retry:_1s_*_2^3_=_8s (0.00s)
    --- PASS: TestCalculateBackoffDelay/fourth_retry:_1s_*_2^4_=_16s (0.00s)
    --- PASS: TestCalculateBackoffDelay/fifth_retry:_capped_at_max_30s (0.00s)
    --- PASS: TestCalculateBackoffDelay/large_retry:_capped_at_max_30s (0.00s)
=== RUN   TestRetryWithCustomConfig
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mcustom-retry-agent [36magent_name=[0mCustomRetryAgent [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:26Z[0m DBG requesting agent response [36magent_id=[0mcustom-retry-agent [36magent_name=[0mCustomRetryAgent [36minput_tokens=[0m5 [36mmax_retries=[0m1
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"simulated failure"[0m[0m [36magent_name=[0mCustomRetryAgent [36mattempt=[0m1 [36mmax_retries=[0m2
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mCustomRetryAgent [36mattempt=[0m1 [36mdelay=[0m300ms [36mmax_retries=[0m1
[90m2025-10-29T02:57:26Z[0m DBG agent response received [36magent_name=[0mCustomRetryAgent [36mattempt=[0m2 [36mduration=[0m"33.773µs"
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:26Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000015000000000000002 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_cost=[0m0.000059999999999999995 [36moutput_tokens=[0m4 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000075
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mCustomRetryAgent [36mcost=[0m0.000075 [36mduration_ms=[0m0 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_tokens=[0m4 [36mtotal_tokens=[0m9
--- PASS: TestRetryWithCustomConfig (0.31s)
=== RUN   TestRetryDefaults
--- PASS: TestRetryDefaults (0.00s)
=== RUN   TestRateLimitingCreation
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mrate-limited-agent [36magent_name=[0mRateLimitedAgent [36magent_type=[0mmock [36mburst=[0m5 [36mrate_limit=[0m10
--- PASS: TestRateLimitingCreation (0.00s)
=== RUN   TestRateLimitingEnforcement
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mrate-limited-agent [36magent_name=[0mRateLimitedAgent [36magent_type=[0mmock [36mburst=[0m2 [36mrate_limit=[0m5
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m5 [36mmode=[0mround-robin
[90m2025-10-29T02:57:26Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-agent [36magent_name=[0mRateLimitedAgent [36minput_tokens=[0m5 [36mmax_retries=[0m3
[90m2025-10-29T02:57:26Z[0m DBG agent response received [36magent_name=[0mRateLimitedAgent [36mattempt=[0m1 [36mduration=[0m"4.298µs"
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:26Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000015000000000000002 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.00003
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mRateLimitedAgent [36mcost=[0m0.00003 [36mduration_ms=[0m0 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m6
[90m2025-10-29T02:57:26Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-agent [36magent_name=[0mRateLimitedAgent [36minput_tokens=[0m7 [36mmax_retries=[0m3
[90m2025-10-29T02:57:26Z[0m DBG agent response received [36magent_name=[0mRateLimitedAgent [36mattempt=[0m1 [36mduration=[0m"7.544µs"
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:26Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000021 [36minput_tokens=[0m7 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000035999999999999994
[90m2025-10-29T02:57:26Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mRateLimitedAgent [36mcost=[0m0.000035999999999999994 [36mduration_ms=[0m0 [36minput_tokens=[0m7 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m8
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-agent [36magent_name=[0mRateLimitedAgent [36minput_tokens=[0m8 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mRateLimitedAgent [36mattempt=[0m1 [36mduration=[0m"9.247µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000024 [36minput_tokens=[0m8 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000039
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mRateLimitedAgent [36mcost=[0m0.000039 [36mduration_ms=[0m0 [36minput_tokens=[0m8 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m9
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-agent [36magent_name=[0mRateLimitedAgent [36minput_tokens=[0m10 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mRateLimitedAgent [36mattempt=[0m1 [36mduration=[0m"10.339µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000030000000000000004 [36minput_tokens=[0m10 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000045
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mRateLimitedAgent [36mcost=[0m0.000045 [36mduration_ms=[0m0 [36minput_tokens=[0m10 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m11
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-agent [36magent_name=[0mRateLimitedAgent [36minput_tokens=[0m12 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mRateLimitedAgent [36mattempt=[0m1 [36mduration=[0m"9.077µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000036 [36minput_tokens=[0m12 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000051
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mRateLimitedAgent [36mcost=[0m0.000051 [36mduration_ms=[0m0 [36minput_tokens=[0m12 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m13
--- PASS: TestRateLimitingEnforcement (0.61s)
=== RUN   TestRateLimitingUnlimited
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0munlimited-agent [36magent_name=[0mUnlimitedAgent [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m3 [36mmode=[0mround-robin
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0munlimited-agent [36magent_name=[0mUnlimitedAgent [36minput_tokens=[0m5 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mUnlimitedAgent [36mattempt=[0m1 [36mduration=[0m"9.718µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000015000000000000002 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.00003
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mUnlimitedAgent [36mcost=[0m0.00003 [36mduration_ms=[0m0 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m6
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0munlimited-agent [36magent_name=[0mUnlimitedAgent [36minput_tokens=[0m6 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mUnlimitedAgent [36mattempt=[0m1 [36mduration=[0m"8.296µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000018 [36minput_tokens=[0m6 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000033
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mUnlimitedAgent [36mcost=[0m0.000033 [36mduration_ms=[0m0 [36minput_tokens=[0m6 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m7
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0munlimited-agent [36magent_name=[0mUnlimitedAgent [36minput_tokens=[0m8 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mUnlimitedAgent [36mattempt=[0m1 [36mduration=[0m"9.808µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000024 [36minput_tokens=[0m8 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000039
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mUnlimitedAgent [36mcost=[0m0.000039 [36mduration_ms=[0m0 [36minput_tokens=[0m8 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m9
--- PASS: TestRateLimitingUnlimited (0.04s)
=== RUN   TestBridgeEventOnCancellation
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36magent_type=[0mmock [36mburst=[0m0 [36mrate_limit=[0m0
Debug: Successfully sent bridge.connected event
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m100 [36mmode=[0mround-robin
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m4 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"7.183µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000012 [36minput_tokens=[0m4 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000027
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.000027 [36mduration_ms=[0m0 [36minput_tokens=[0m4 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m5
Debug: Successfully sent conversation.started event
Debug: Successfully sent message.created event
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m5 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"9.197µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000015000000000000002 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.00003
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.00003 [36mduration_ms=[0m0 [36minput_tokens=[0m5 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m6
Debug: Successfully sent message.created event
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m7 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"9.758µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000021 [36minput_tokens=[0m7 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000035999999999999994
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.000035999999999999994 [36mduration_ms=[0m0 [36minput_tokens=[0m7 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m8
Debug: Successfully sent message.created event
[90m2025-10-29T02:57:27Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgent1 [36minput_tokens=[0m9 [36mmax_retries=[0m3
[90m2025-10-29T02:57:27Z[0m DBG agent response received [36magent_name=[0mAgent1 [36mattempt=[0m1 [36mduration=[0m"9.037µs"
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1mfound model via prefix match[0m [36mactual_id=[0mclaude-sonnet-4-5 [36mmatch=[0mprefix [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0m [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:27Z[0m DBG calculated cost estimate [36minput_cost=[0m0.000027 [36minput_tokens=[0m9 [36mmodel=[0m [36moutput_cost=[0m0.000014999999999999999 [36moutput_tokens=[0m1 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m0.000042
[90m2025-10-29T02:57:27Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgent1 [36mcost=[0m0.000042 [36mduration_ms=[0m0 [36minput_tokens=[0m9 [36mmodel=[0m [36moutput_tokens=[0m1 [36mtotal_tokens=[0m10
Debug: Successfully sent message.created event
Debug: Successfully sent conversation.completed event
--- PASS: TestBridgeEventOnCancellation (0.22s)
=== RUN   TestParseDualSummary_ValidFormat
=== RUN   TestParseDualSummary_ValidFormat/basic_format
=== RUN   TestParseDualSummary_ValidFormat/multiline_content
=== RUN   TestParseDualSummary_ValidFormat/content_on_same_line_as_marker
=== RUN   TestParseDualSummary_ValidFormat/content_on_next_line_after_marker
=== RUN   TestParseDualSummary_ValidFormat/extra_whitespace
--- PASS: TestParseDualSummary_ValidFormat (0.00s)
    --- PASS: TestParseDualSummary_ValidFormat/basic_format (0.00s)
    --- PASS: TestParseDualSummary_ValidFormat/multiline_content (0.00s)
    --- PASS: TestParseDualSummary_ValidFormat/content_on_same_line_as_marker (0.00s)
    --- PASS: TestParseDualSummary_ValidFormat/content_on_next_line_after_marker (0.00s)
    --- PASS: TestParseDualSummary_ValidFormat/extra_whitespace (0.00s)
=== RUN   TestParseDualSummary_ErrorCases
=== RUN   TestParseDualSummary_ErrorCases/missing_SHORT_marker
=== RUN   TestParseDualSummary_ErrorCases/missing_FULL_marker
=== RUN   TestParseDualSummary_ErrorCases/empty_response
=== RUN   TestParseDualSummary_ErrorCases/only_markers_no_content
=== RUN   TestParseDualSummary_ErrorCases/SHORT_with_empty_content
=== RUN   TestParseDualSummary_ErrorCases/FULL_with_empty_content
--- PASS: TestParseDualSummary_ErrorCases (0.00s)
    --- PASS: TestParseDualSummary_ErrorCases/missing_SHORT_marker (0.00s)
    --- PASS: TestParseDualSummary_ErrorCases/missing_FULL_marker (0.00s)
    --- PASS: TestParseDualSummary_ErrorCases/empty_response (0.00s)
    --- PASS: TestParseDualSummary_ErrorCases/only_markers_no_content (0.00s)
    --- PASS: TestParseDualSummary_ErrorCases/SHORT_with_empty_content (0.00s)
    --- PASS: TestParseDualSummary_ErrorCases/FULL_with_empty_content (0.00s)
=== RUN   TestParseDualSummary_RealWorldExamples
--- PASS: TestParseDualSummary_RealWorldExamples (0.00s)
=== RUN   TestGetSummary
--- PASS: TestGetSummary (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/orchestrator	4.267s
=== RUN   TestNewLimiter
=== RUN   TestNewLimiter/normal_rate
=== RUN   TestNewLimiter/zero_rate_disables
=== RUN   TestNewLimiter/negative_rate_disables
=== RUN   TestNewLimiter/zero_burst_clamped_to_1
=== RUN   TestNewLimiter/negative_burst_clamped_to_1
--- PASS: TestNewLimiter (0.00s)
    --- PASS: TestNewLimiter/normal_rate (0.00s)
    --- PASS: TestNewLimiter/zero_rate_disables (0.00s)
    --- PASS: TestNewLimiter/negative_rate_disables (0.00s)
    --- PASS: TestNewLimiter/zero_burst_clamped_to_1 (0.00s)
    --- PASS: TestNewLimiter/negative_burst_clamped_to_1 (0.00s)
=== RUN   TestLimiterDisabled
--- PASS: TestLimiterDisabled (0.00s)
=== RUN   TestLimiterBurst
--- PASS: TestLimiterBurst (0.00s)
=== RUN   TestLimiterRefill
--- PASS: TestLimiterRefill (0.15s)
=== RUN   TestLimiterWait
--- PASS: TestLimiterWait (0.20s)
=== RUN   TestLimiterWaitContext
--- PASS: TestLimiterWaitContext (0.05s)
=== RUN   TestLimiterConcurrent
--- PASS: TestLimiterConcurrent (0.40s)
=== RUN   TestLimiterSetRate
--- PASS: TestLimiterSetRate (0.00s)
=== RUN   TestLimiterSetBurst
--- PASS: TestLimiterSetBurst (0.00s)
=== RUN   TestLimiterGetStats
--- PASS: TestLimiterGetStats (0.00s)
=== RUN   TestLimiterString
=== RUN   TestLimiterString/enabled
=== RUN   TestLimiterString/disabled
--- PASS: TestLimiterString (0.00s)
    --- PASS: TestLimiterString/enabled (0.00s)
    --- PASS: TestLimiterString/disabled (0.00s)
=== RUN   TestLimiterTokenAccumulation
--- PASS: TestLimiterTokenAccumulation (1.50s)
=== RUN   TestCalculateWaitTime
--- PASS: TestCalculateWaitTime (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/ratelimit	3.315s
=== RUN   TestEnhancedModel_Init
=== RUN   TestEnhancedModel_Init/Already_initialized
=== RUN   TestEnhancedModel_Init/Not_initialized
--- PASS: TestEnhancedModel_Init (0.00s)
    --- PASS: TestEnhancedModel_Init/Already_initialized (0.00s)
    --- PASS: TestEnhancedModel_Init/Not_initialized (0.00s)
=== RUN   TestEnhancedModel_Update_KeyMsg
=== RUN   TestEnhancedModel_Update_KeyMsg/q_quits
=== RUN   TestEnhancedModel_Update_KeyMsg/ctrl+c_quits
=== RUN   TestEnhancedModel_Update_KeyMsg/tab_cycles_conversation_to_input
=== RUN   TestEnhancedModel_Update_KeyMsg/esc_closes_modal
=== RUN   TestEnhancedModel_Update_KeyMsg/enter_closes_modal
--- PASS: TestEnhancedModel_Update_KeyMsg (0.01s)
    --- PASS: TestEnhancedModel_Update_KeyMsg/q_quits (0.00s)
    --- PASS: TestEnhancedModel_Update_KeyMsg/ctrl+c_quits (0.00s)
    --- PASS: TestEnhancedModel_Update_KeyMsg/tab_cycles_conversation_to_input (0.00s)
    --- PASS: TestEnhancedModel_Update_KeyMsg/esc_closes_modal (0.00s)
    --- PASS: TestEnhancedModel_Update_KeyMsg/enter_closes_modal (0.00s)
=== RUN   TestEnhancedModel_Update_WindowSize
--- PASS: TestEnhancedModel_Update_WindowSize (0.00s)
=== RUN   TestEnhancedModel_Update_MessageUpdate
=== RUN   TestEnhancedModel_Update_MessageUpdate/System_message
=== RUN   TestEnhancedModel_Update_MessageUpdate/Agent_message_with_metrics
=== RUN   TestEnhancedModel_Update_MessageUpdate/Agent_message_without_metrics
--- PASS: TestEnhancedModel_Update_MessageUpdate (0.00s)
    --- PASS: TestEnhancedModel_Update_MessageUpdate/System_message (0.00s)
    --- PASS: TestEnhancedModel_Update_MessageUpdate/Agent_message_with_metrics (0.00s)
    --- PASS: TestEnhancedModel_Update_MessageUpdate/Agent_message_without_metrics (0.00s)
=== RUN   TestEnhancedModel_Update_AgentInit
=== RUN   TestEnhancedModel_Update_AgentInit/Successful_initialization
=== RUN   TestEnhancedModel_Update_AgentInit/Failed_initialization
--- PASS: TestEnhancedModel_Update_AgentInit (0.00s)
    --- PASS: TestEnhancedModel_Update_AgentInit/Successful_initialization (0.00s)
    --- PASS: TestEnhancedModel_Update_AgentInit/Failed_initialization (0.00s)
=== RUN   TestEnhancedModel_PanelNavigation
--- PASS: TestEnhancedModel_PanelNavigation (0.00s)
=== RUN   TestWrapText
=== RUN   TestWrapText/Short_text_no_wrap
=== RUN   TestWrapText/Text_exactly_at_width
=== RUN   TestWrapText/Text_wraps_once
=== RUN   TestWrapText/Text_with_newlines
=== RUN   TestWrapText/Very_long_word
=== RUN   TestWrapText/Zero_width
--- PASS: TestWrapText (0.00s)
    --- PASS: TestWrapText/Short_text_no_wrap (0.00s)
    --- PASS: TestWrapText/Text_exactly_at_width (0.00s)
    --- PASS: TestWrapText/Text_wraps_once (0.00s)
    --- PASS: TestWrapText/Text_with_newlines (0.00s)
    --- PASS: TestWrapText/Very_long_word (0.00s)
    --- PASS: TestWrapText/Zero_width (0.00s)
=== RUN   TestEnhancedModel_RenderAgentList
--- PASS: TestEnhancedModel_RenderAgentList (0.00s)
=== RUN   TestEnhancedModel_RenderConfig
--- PASS: TestEnhancedModel_RenderConfig (0.00s)
=== RUN   TestEnhancedModel_RenderStats
--- PASS: TestEnhancedModel_RenderStats (0.00s)
=== RUN   TestEnhancedModel_RenderConversation
--- PASS: TestEnhancedModel_RenderConversation (0.00s)
=== RUN   TestMessageWriter_Write
=== RUN   TestMessageWriter_Write/System_message
=== RUN   TestMessageWriter_Write/Agent_message
=== RUN   TestMessageWriter_Write/Agent_message_with_metrics
=== RUN   TestMessageWriter_Write/Error_message
--- PASS: TestMessageWriter_Write (0.00s)
    --- PASS: TestMessageWriter_Write/System_message (0.00s)
    --- PASS: TestMessageWriter_Write/Agent_message (0.00s)
    --- PASS: TestMessageWriter_Write/Agent_message_with_metrics (0.00s)
    --- PASS: TestMessageWriter_Write/Error_message (0.00s)
=== RUN   TestMessageWriter_MultilineMessage
    enhanced_test.go:774: TODO: Fix multiline message parsing - content not being captured correctly
--- SKIP: TestMessageWriter_MultilineMessage (0.00s)
=== RUN   TestEnhancedModel_View
=== RUN   TestEnhancedModel_View/Not_ready
=== RUN   TestEnhancedModel_View/Ready_with_UI
    enhanced_test.go:866: TODO: Update test expectation for new logo format
=== RUN   TestEnhancedModel_View/Modal_shown
--- PASS: TestEnhancedModel_View (0.00s)
    --- PASS: TestEnhancedModel_View/Not_ready (0.00s)
    --- SKIP: TestEnhancedModel_View/Ready_with_UI (0.00s)
    --- PASS: TestEnhancedModel_View/Modal_shown (0.00s)
=== RUN   TestMessageWriter_BufferHandling
--- PASS: TestMessageWriter_BufferHandling (0.00s)
=== RUN   TestMessageWriter_FlushOnDoubleNewline
--- PASS: TestMessageWriter_FlushOnDoubleNewline (0.01s)
=== RUN   TestModel_Init
--- PASS: TestModel_Init (0.00s)
=== RUN   TestModel_Update_KeyMsg
=== RUN   TestModel_Update_KeyMsg/Ctrl+C_quits
=== RUN   TestModel_Update_KeyMsg/Escape_quits
=== RUN   TestModel_Update_KeyMsg/Ctrl+S_starts_conversation_when_stopped
=== RUN   TestModel_Update_KeyMsg/Ctrl+P_toggles_pause
--- PASS: TestModel_Update_KeyMsg (0.00s)
    --- PASS: TestModel_Update_KeyMsg/Ctrl+C_quits (0.00s)
    --- PASS: TestModel_Update_KeyMsg/Escape_quits (0.00s)
    --- PASS: TestModel_Update_KeyMsg/Ctrl+S_starts_conversation_when_stopped (0.00s)
    --- PASS: TestModel_Update_KeyMsg/Ctrl+P_toggles_pause (0.00s)
=== RUN   TestModel_Update_WindowSize
--- PASS: TestModel_Update_WindowSize (0.00s)
=== RUN   TestModel_Update_MessageUpdate
--- PASS: TestModel_Update_MessageUpdate (0.00s)
=== RUN   TestModel_Update_ConversationDone
--- PASS: TestModel_Update_ConversationDone (0.00s)
=== RUN   TestModel_Update_ErrMsg
--- PASS: TestModel_Update_ErrMsg (0.00s)
=== RUN   TestModel_View
=== RUN   TestModel_View/Not_ready_shows_initialization
=== RUN   TestModel_View/Ready_shows_UI
--- PASS: TestModel_View (0.00s)
    --- PASS: TestModel_View/Not_ready_shows_initialization (0.00s)
    --- PASS: TestModel_View/Ready_shows_UI (0.00s)
=== RUN   TestModel_RenderMessages
=== RUN   TestModel_RenderMessages/Empty_messages
=== RUN   TestModel_RenderMessages/System_message
=== RUN   TestModel_RenderMessages/Agent_message
=== RUN   TestModel_RenderMessages/Multiple_messages
--- PASS: TestModel_RenderMessages (0.00s)
    --- PASS: TestModel_RenderMessages/Empty_messages (0.00s)
    --- PASS: TestModel_RenderMessages/System_message (0.00s)
    --- PASS: TestModel_RenderMessages/Agent_message (0.00s)
    --- PASS: TestModel_RenderMessages/Multiple_messages (0.00s)
=== RUN   TestTuiWriter
=== RUN   TestTuiWriter/Write_empty
=== RUN   TestTuiWriter/Write_text
=== RUN   TestTuiWriter/Write_with_newline
--- PASS: TestTuiWriter (0.00s)
    --- PASS: TestTuiWriter/Write_empty (0.00s)
    --- PASS: TestTuiWriter/Write_text (0.00s)
    --- PASS: TestTuiWriter/Write_with_newline (0.00s)
=== RUN   TestModel_StartConversation
--- PASS: TestModel_StartConversation (0.00s)
=== RUN   TestModel_SearchMode
[90m2025-10-29T02:57:26Z[0m [31mERR[0m [1mconversation start failed: no agents configured[0m
--- PASS: TestModel_SearchMode (0.00s)
=== RUN   TestModel_PerformSearch
=== RUN   TestModel_PerformSearch/Search_for_'hello'
=== RUN   TestModel_PerformSearch/Search_for_'search'
=== RUN   TestModel_PerformSearch/Search_for_'Agent1'
=== RUN   TestModel_PerformSearch/Search_for_non-existent_term
=== RUN   TestModel_PerformSearch/Empty_search
--- PASS: TestModel_PerformSearch (0.00s)
    --- PASS: TestModel_PerformSearch/Search_for_'hello' (0.00s)
    --- PASS: TestModel_PerformSearch/Search_for_'search' (0.00s)
    --- PASS: TestModel_PerformSearch/Search_for_'Agent1' (0.00s)
    --- PASS: TestModel_PerformSearch/Search_for_non-existent_term (0.00s)
    --- PASS: TestModel_PerformSearch/Empty_search (0.00s)
=== RUN   TestModel_SearchNavigation
--- PASS: TestModel_SearchNavigation (0.00s)
=== RUN   TestModel_CommandMode
--- PASS: TestModel_CommandMode (0.00s)
=== RUN   TestModel_ExecuteFilterCommand
--- PASS: TestModel_ExecuteFilterCommand (0.00s)
=== RUN   TestModel_ExecuteClearCommand
--- PASS: TestModel_ExecuteClearCommand (0.00s)
=== RUN   TestModel_FilterMessages
--- PASS: TestModel_FilterMessages (0.00s)
=== RUN   TestModel_UnknownCommand
--- PASS: TestModel_UnknownCommand (0.00s)
=== RUN   TestModel_HelpModal
--- PASS: TestModel_HelpModal (0.00s)
=== RUN   TestModel_HelpModalContent
--- PASS: TestModel_HelpModalContent (0.00s)
=== RUN   TestModel_MultiplePanelUpdates
--- PASS: TestModel_MultiplePanelUpdates (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/tui	1.067s
=== RUN   TestEstimateTokens
=== RUN   TestEstimateTokens/empty_string
=== RUN   TestEstimateTokens/single_word
=== RUN   TestEstimateTokens/short_sentence
=== RUN   TestEstimateTokens/with_punctuation
=== RUN   TestEstimateTokens/with_numbers
--- PASS: TestEstimateTokens (0.00s)
    --- PASS: TestEstimateTokens/empty_string (0.00s)
    --- PASS: TestEstimateTokens/single_word (0.00s)
    --- PASS: TestEstimateTokens/short_sentence (0.00s)
    --- PASS: TestEstimateTokens/with_punctuation (0.00s)
    --- PASS: TestEstimateTokens/with_numbers (0.00s)
=== RUN   TestEstimateCost
=== RUN   TestEstimateCost/claude-sonnet-4-5
[90m2025-10-29T02:57:26Z[0m DBG loaded embedded provider config [36mproviders=[0m16 [36msource=[0membedded [36mversion=[0m1.0
[90m2025-10-29T02:57:26Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5-20250929 [36mprovider=[0mAnthropic
[90m2025-10-29T02:57:26Z[0m DBG calculated cost estimate [36minput_cost=[0m3 [36minput_tokens=[0m1000000 [36mmodel=[0mclaude-sonnet-4-5-20250929 [36moutput_cost=[0m15 [36moutput_tokens=[0m1000000 [36mprovider=[0mAnthropic [36mtotal_cost=[0m18
=== RUN   TestEstimateCost/claude-3-5-haiku
[90m2025-10-29T02:57:26Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude 3.5 Haiku" [36mmodel_id=[0mclaude-3-5-haiku-20241022 [36mprovider=[0mAnthropic
[90m2025-10-29T02:57:26Z[0m DBG calculated cost estimate [36minput_cost=[0m0.7999999999999999 [36minput_tokens=[0m1000000 [36mmodel=[0mclaude-3-5-haiku-20241022 [36moutput_cost=[0m4 [36moutput_tokens=[0m1000000 [36mprovider=[0mAnthropic [36mtotal_cost=[0m4.8
=== RUN   TestEstimateCost/gpt-5
[90m2025-10-29T02:57:26Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0mGPT-5 [36mmodel_id=[0mgpt-5 [36mprovider=[0mAIHubMix
[90m2025-10-29T02:57:26Z[0m DBG calculated cost estimate [36minput_cost=[0m1.25 [36minput_tokens=[0m1000000 [36mmodel=[0mgpt-5 [36moutput_cost=[0m10 [36moutput_tokens=[0m1000000 [36mprovider=[0mAIHubMix [36mtotal_cost=[0m11.25
=== RUN   TestEstimateCost/unknown_model
[90m2025-10-29T02:57:26Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m1000 [36mmodel=[0mcompletely-unknown-model-xyz [36moutput_tokens=[0m500
=== RUN   TestEstimateCost/zero_tokens
[90m2025-10-29T02:57:26Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5-20250929 [36mprovider=[0mAnthropic
[90m2025-10-29T02:57:26Z[0m DBG calculated cost estimate [36minput_cost=[0m0 [36minput_tokens=[0m0 [36mmodel=[0mclaude-sonnet-4-5-20250929 [36moutput_cost=[0m0 [36moutput_tokens=[0m0 [36mprovider=[0mAnthropic [36mtotal_cost=[0m0
=== RUN   TestEstimateCost/small_token_count
[90m2025-10-29T02:57:26Z[0m DBG found model via exact match [36mmatch=[0mexact [36mmodel=[0m"Claude Sonnet 4.5" [36mmodel_id=[0mclaude-sonnet-4-5-20250929 [36mprovider=[0mAnthropic
[90m2025-10-29T02:57:26Z[0m DBG calculated cost estimate [36minput_cost=[0m0.003 [36minput_tokens=[0m1000 [36mmodel=[0mclaude-sonnet-4-5-20250929 [36moutput_cost=[0m0.0075 [36moutput_tokens=[0m500 [36mprovider=[0mAnthropic [36mtotal_cost=[0m0.010499999999999999
--- PASS: TestEstimateCost (0.02s)
    --- PASS: TestEstimateCost/claude-sonnet-4-5 (0.02s)
    --- PASS: TestEstimateCost/claude-3-5-haiku (0.00s)
    --- PASS: TestEstimateCost/gpt-5 (0.00s)
    --- PASS: TestEstimateCost/unknown_model (0.00s)
    --- PASS: TestEstimateCost/zero_tokens (0.00s)
    --- PASS: TestEstimateCost/small_token_count (0.00s)
=== RUN   TestEstimateCostLegacy
=== RUN   TestEstimateCostLegacy/claude-3-opus
=== RUN   TestEstimateCostLegacy/gpt-4
--- PASS: TestEstimateCostLegacy (0.00s)
    --- PASS: TestEstimateCostLegacy/claude-3-opus (0.00s)
    --- PASS: TestEstimateCostLegacy/gpt-4 (0.00s)
PASS
ok  	github.com/kevinelliott/agentpipe/pkg/utils	1.033s
testing: warning: no tests to run
PASS
ok  	github.com/kevinelliott/agentpipe/test/benchmark	1.015s [no tests to run]
=== RUN   TestFullConversationRoundRobin
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-1 [36magent_name=[0mAlice [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-2 [36magent_name=[0mBob [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m2 [36mhas_prompt=[0mtrue [36mmax_turns=[0m2 [36mmode=[0mround-robin
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAlice [36minput_tokens=[0m22 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m DBG agent response received [36magent_name=[0mAlice [36mattempt=[0m1 [36mduration=[0m"15.73µs"
[90m2025-10-29T02:57:28Z[0m DBG loaded embedded provider config [36mproviders=[0m16 [36msource=[0membedded [36mversion=[0m1.0
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m22 [36mmodel=[0mmock [36moutput_tokens=[0m8
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAlice [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m22 [36mmodel=[0mmock [36moutput_tokens=[0m8 [36mtotal_tokens=[0m30
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0magent-2 [36magent_name=[0mBob [36minput_tokens=[0m31 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m DBG agent response received [36magent_name=[0mBob [36mattempt=[0m1 [36mduration=[0m"9.508µs"
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m31 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mBob [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m31 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m37
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAlice [36minput_tokens=[0m38 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m DBG agent response received [36magent_name=[0mAlice [36mattempt=[0m1 [36mduration=[0m"22.302µs"
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m38 [36mmodel=[0mmock [36moutput_tokens=[0m8
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAlice [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m38 [36mmodel=[0mmock [36moutput_tokens=[0m8 [36mtotal_tokens=[0m46
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0magent-2 [36magent_name=[0mBob [36minput_tokens=[0m47 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m DBG agent response received [36magent_name=[0mBob [36mattempt=[0m1 [36mduration=[0m"9.959µs"
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m47 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mBob [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m47 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m53
--- PASS: TestFullConversationRoundRobin (0.07s)
=== RUN   TestFullConversationWithRateLimiting
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mrate-limited-1 [36magent_name=[0mLimitedAgent [36magent_type=[0mmock [36mburst=[0m2 [36mrate_limit=[0m5
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m5 [36mmode=[0mround-robin
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-1 [36magent_name=[0mLimitedAgent [36minput_tokens=[0m8 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m DBG agent response received [36magent_name=[0mLimitedAgent [36mattempt=[0m1 [36mduration=[0m"7.804µs"
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m8 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mLimitedAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m8 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m14
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-1 [36magent_name=[0mLimitedAgent [36minput_tokens=[0m15 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m DBG agent response received [36magent_name=[0mLimitedAgent [36mattempt=[0m1 [36mduration=[0m"8.375µs"
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m15 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mLimitedAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m15 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m21
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-1 [36magent_name=[0mLimitedAgent [36minput_tokens=[0m22 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m DBG agent response received [36magent_name=[0mLimitedAgent [36mattempt=[0m1 [36mduration=[0m"9.748µs"
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m22 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mLimitedAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m22 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m28
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-1 [36magent_name=[0mLimitedAgent [36minput_tokens=[0m29 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m DBG agent response received [36magent_name=[0mLimitedAgent [36mattempt=[0m1 [36mduration=[0m"7.163µs"
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m29 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mLimitedAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m29 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m35
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0mrate-limited-1 [36magent_name=[0mLimitedAgent [36minput_tokens=[0m36 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m DBG agent response received [36magent_name=[0mLimitedAgent [36mattempt=[0m1 [36mduration=[0m"9.537µs"
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m36 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mLimitedAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m36 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m42
--- PASS: TestFullConversationWithRateLimiting (0.61s)
=== RUN   TestFullConversationWithRetries
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mretry-agent [36magent_name=[0mRetryAgent [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:28Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:28Z[0m DBG requesting agent response [36magent_id=[0mretry-agent [36magent_name=[0mRetryAgent [36minput_tokens=[0m8 [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"simulated failure"[0m[0m [36magent_name=[0mRetryAgent [36mattempt=[0m1 [36mmax_retries=[0m4
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mRetryAgent [36mattempt=[0m1 [36mdelay=[0m100ms [36mmax_retries=[0m3
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"simulated failure"[0m[0m [36magent_name=[0mRetryAgent [36mattempt=[0m2 [36mmax_retries=[0m4
[90m2025-10-29T02:57:28Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mRetryAgent [36mattempt=[0m2 [36mdelay=[0m200ms [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mRetryAgent [36mattempt=[0m3 [36mduration=[0m"13.925µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m8 [36mmodel=[0mmock [36moutput_tokens=[0m4
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mRetryAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m8 [36mmodel=[0mmock [36moutput_tokens=[0m4 [36mtotal_tokens=[0m12
--- PASS: TestFullConversationWithRetries (0.31s)
=== RUN   TestFullConversationReactiveMode
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-1 [36magent_name=[0mAgentA [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-2 [36magent_name=[0mAgentB [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0magent-3 [36magent_name=[0mAgentC [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m3 [36mhas_prompt=[0mfalse [36mmax_turns=[0m5 [36mmode=[0mreactive
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0magent-3 [36magent_name=[0mAgentC [36minput_tokens=[0m23 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mAgentC [36mattempt=[0m1 [36mduration=[0m"8.025µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m23 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgentC [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m23 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m29
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgentA [36minput_tokens=[0m29 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mAgentA [36mattempt=[0m1 [36mduration=[0m"16.07µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m29 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgentA [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m29 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m35
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0magent-3 [36magent_name=[0mAgentC [36minput_tokens=[0m35 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mAgentC [36mattempt=[0m1 [36mduration=[0m"8.055µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m35 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgentC [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m35 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m41
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0magent-1 [36magent_name=[0mAgentA [36minput_tokens=[0m42 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mAgentA [36mattempt=[0m1 [36mduration=[0m"8.475µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m42 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgentA [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m42 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m48
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0magent-2 [36magent_name=[0mAgentB [36minput_tokens=[0m48 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mAgentB [36mattempt=[0m1 [36mduration=[0m"13.304µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m48 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mAgentB [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m48 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m54
--- PASS: TestFullConversationReactiveMode (0.06s)
=== RUN   TestConfigurationLoading
--- PASS: TestConfigurationLoading (0.00s)
=== RUN   TestMultiAgentConversationContext
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mcontext-1 [36magent_name=[0mContextAgent1 [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mcontext-2 [36magent_name=[0mContextAgent2 [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m2 [36mhas_prompt=[0mfalse [36mmax_turns=[0m2 [36mmode=[0mround-robin
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mcontext-1 [36magent_name=[0mContextAgent1 [36minput_tokens=[0m17 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mContextAgent1 [36mattempt=[0m1 [36mduration=[0m"8.696µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m17 [36mmodel=[0mmock [36moutput_tokens=[0m4
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mContextAgent1 [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m17 [36mmodel=[0mmock [36moutput_tokens=[0m4 [36mtotal_tokens=[0m21
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mcontext-2 [36magent_name=[0mContextAgent2 [36minput_tokens=[0m21 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mContextAgent2 [36mattempt=[0m1 [36mduration=[0m"8.666µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m21 [36mmodel=[0mmock [36moutput_tokens=[0m4
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mContextAgent2 [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m21 [36mmodel=[0mmock [36moutput_tokens=[0m4 [36mtotal_tokens=[0m25
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mcontext-1 [36magent_name=[0mContextAgent1 [36minput_tokens=[0m26 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mContextAgent1 [36mattempt=[0m1 [36mduration=[0m"8.947µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m26 [36mmodel=[0mmock [36moutput_tokens=[0m4
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mContextAgent1 [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m26 [36mmodel=[0mmock [36moutput_tokens=[0m4 [36mtotal_tokens=[0m30
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mcontext-2 [36magent_name=[0mContextAgent2 [36minput_tokens=[0m31 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mContextAgent2 [36mattempt=[0m1 [36mduration=[0m"8.105µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m31 [36mmodel=[0mmock [36moutput_tokens=[0m4
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mContextAgent2 [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m31 [36mmodel=[0mmock [36moutput_tokens=[0m4 [36mtotal_tokens=[0m35
    conversation_test.go:449: Conversation log: [Agent1 sees 2 messages Agent2 sees 3 messages Agent1 sees 4 messages Agent2 sees 5 messages]
--- PASS: TestMultiAgentConversationContext (0.04s)
=== RUN   TestConversationWithFailingAgent
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mfailing [36magent_name=[0mFailingAgent [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mworking [36magent_name=[0mWorkingAgent [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m2 [36mhas_prompt=[0mfalse [36mmax_turns=[0m2 [36mmode=[0mround-robin
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mfailing [36magent_name=[0mFailingAgent [36minput_tokens=[0m17 [36mmax_retries=[0m0
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"persistent failure"[0m[0m [36magent_name=[0mFailingAgent [36mattempt=[0m1 [36mmax_retries=[0m1
[90m2025-10-29T02:57:29Z[0m [31mERR[0m [1mall agent request attempts failed[0m [36merror=[0m[31m[1m"persistent failure"[0m[0m [36magent_name=[0mFailingAgent [36mattempts=[0m1
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mworking [36magent_name=[0mWorkingAgent [36minput_tokens=[0m17 [36mmax_retries=[0m0
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mWorkingAgent [36mattempt=[0m1 [36mduration=[0m"7.213µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m17 [36mmodel=[0mmock [36moutput_tokens=[0m3
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mWorkingAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m17 [36mmodel=[0mmock [36moutput_tokens=[0m3 [36mtotal_tokens=[0m20
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mfailing [36magent_name=[0mFailingAgent [36minput_tokens=[0m20 [36mmax_retries=[0m0
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"persistent failure"[0m[0m [36magent_name=[0mFailingAgent [36mattempt=[0m1 [36mmax_retries=[0m1
[90m2025-10-29T02:57:29Z[0m [31mERR[0m [1mall agent request attempts failed[0m [36merror=[0m[31m[1m"persistent failure"[0m[0m [36magent_name=[0mFailingAgent [36mattempts=[0m1
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mworking [36magent_name=[0mWorkingAgent [36minput_tokens=[0m20 [36mmax_retries=[0m0
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mWorkingAgent [36mattempt=[0m1 [36mduration=[0m"7.675µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m20 [36mmodel=[0mmock [36moutput_tokens=[0m3
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mWorkingAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m20 [36mmodel=[0mmock [36moutput_tokens=[0m3 [36mtotal_tokens=[0m23
--- PASS: TestConversationWithFailingAgent (0.04s)
=== RUN   TestConversationContextCancellation
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mslow [36magent_name=[0mSlowAgent [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m100 [36mmode=[0mround-robin
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mslow [36magent_name=[0mSlowAgent [36minput_tokens=[0m7 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mSlowAgent [36mattempt=[0m1 [36mduration=[0m100.321963ms
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m7 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mSlowAgent [36mcost=[0m0 [36mduration_ms=[0m100 [36minput_tokens=[0m7 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m13
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mslow [36magent_name=[0mSlowAgent [36minput_tokens=[0m14 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mSlowAgent [36mattempt=[0m1 [36mduration=[0m100.303238ms
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m14 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mSlowAgent [36mcost=[0m0 [36mduration_ms=[0m100 [36minput_tokens=[0m14 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m20
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mslow [36magent_name=[0mSlowAgent [36minput_tokens=[0m21 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"context deadline exceeded"[0m[0m [36magent_name=[0mSlowAgent [36mattempt=[0m1 [36mmax_retries=[0m4
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mSlowAgent [36mattempt=[0m1 [36mdelay=[0m2s [36mmax_retries=[0m3
--- PASS: TestConversationContextCancellation (0.26s)
=== RUN   TestConversationAgentTimeout
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mtimeout [36magent_name=[0mTimeoutAgent [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mtimeout [36magent_name=[0mTimeoutAgent [36minput_tokens=[0m8 [36mmax_retries=[0m0
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"context deadline exceeded"[0m[0m [36magent_name=[0mTimeoutAgent [36mattempt=[0m1 [36mmax_retries=[0m1
[90m2025-10-29T02:57:29Z[0m [31mERR[0m [1mall agent request attempts failed[0m [36merror=[0m[31m[1m"context deadline exceeded"[0m[0m [36magent_name=[0mTimeoutAgent [36mattempts=[0m1
--- PASS: TestConversationAgentTimeout (0.11s)
=== RUN   TestConversationNoAgents
[90m2025-10-29T02:57:29Z[0m [31mERR[0m [1mconversation start failed: no agents configured[0m
--- PASS: TestConversationNoAgents (0.00s)
=== RUN   TestConversationMaxTurnsLimit
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mfast [36magent_name=[0mFastAgent [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m3 [36mmode=[0mround-robin
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mfast [36magent_name=[0mFastAgent [36minput_tokens=[0m7 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mFastAgent [36mattempt=[0m1 [36mduration=[0m"7.174µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m7 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mFastAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m7 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m13
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mfast [36magent_name=[0mFastAgent [36minput_tokens=[0m14 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mFastAgent [36mattempt=[0m1 [36mduration=[0m"7.063µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m14 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mFastAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m14 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m20
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mfast [36magent_name=[0mFastAgent [36minput_tokens=[0m21 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mFastAgent [36mattempt=[0m1 [36mduration=[0m"5.4µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m21 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mFastAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m21 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m27
--- PASS: TestConversationMaxTurnsLimit (0.03s)
=== RUN   TestConversationRetryExhaustion
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0malways-fail [36magent_name=[0mAlwaysFailAgent [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0malways-fail [36magent_name=[0mAlwaysFailAgent [36minput_tokens=[0m8 [36mmax_retries=[0m2
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"permanent error"[0m[0m [36magent_name=[0mAlwaysFailAgent [36mattempt=[0m1 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mAlwaysFailAgent [36mattempt=[0m1 [36mdelay=[0m100ms [36mmax_retries=[0m2
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"permanent error"[0m[0m [36magent_name=[0mAlwaysFailAgent [36mattempt=[0m2 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mretrying agent request after failure[0m [36magent_name=[0mAlwaysFailAgent [36mattempt=[0m2 [36mdelay=[0m200ms [36mmax_retries=[0m2
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1magent request attempt failed[0m [36merror=[0m[31m[1m"permanent error"[0m[0m [36magent_name=[0mAlwaysFailAgent [36mattempt=[0m3 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m [31mERR[0m [1mall agent request attempts failed[0m [36merror=[0m[31m[1m"permanent error"[0m[0m [36magent_name=[0mAlwaysFailAgent [36mattempts=[0m3
--- PASS: TestConversationRetryExhaustion (0.31s)
=== RUN   TestConversationFreeFormMode
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mfreeform-1 [36magent_name=[0mFreeAgentA [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mfreeform-2 [36magent_name=[0mFreeAgentB [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mfreeform-3 [36magent_name=[0mFreeAgentC [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m3 [36mhas_prompt=[0mfalse [36mmax_turns=[0m3 [36mmode=[0mfree-form
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mfreeform-1 [36magent_name=[0mFreeAgentA [36minput_tokens=[0m25 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mFreeAgentA [36mattempt=[0m1 [36mduration=[0m"10.85µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m25 [36mmodel=[0mmock [36moutput_tokens=[0m5
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mFreeAgentA [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m25 [36mmodel=[0mmock [36moutput_tokens=[0m5 [36mtotal_tokens=[0m30
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mfreeform-2 [36magent_name=[0mFreeAgentB [36minput_tokens=[0m30 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mFreeAgentB [36mattempt=[0m1 [36mduration=[0m"12.083µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m30 [36mmodel=[0mmock [36moutput_tokens=[0m5
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mFreeAgentB [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m30 [36mmodel=[0mmock [36moutput_tokens=[0m5 [36mtotal_tokens=[0m35
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mfreeform-3 [36magent_name=[0mFreeAgentC [36minput_tokens=[0m35 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mFreeAgentC [36mattempt=[0m1 [36mduration=[0m"8.205µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m35 [36mmodel=[0mmock [36moutput_tokens=[0m5
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mFreeAgentC [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m35 [36mmodel=[0mmock [36moutput_tokens=[0m5 [36mtotal_tokens=[0m40
--- PASS: TestConversationFreeFormMode (0.03s)
=== RUN   TestConversationWithMetrics
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0mmetrics [36magent_name=[0mMetricsAgent [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mfalse [36mmax_turns=[0m2 [36mmode=[0mround-robin
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mmetrics [36magent_name=[0mMetricsAgent [36minput_tokens=[0m8 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mMetricsAgent [36mattempt=[0m1 [36mduration=[0m20.255899ms
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m8 [36mmodel=[0mmock [36moutput_tokens=[0m17
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mMetricsAgent [36mcost=[0m0 [36mduration_ms=[0m20 [36minput_tokens=[0m8 [36mmodel=[0mmock [36moutput_tokens=[0m17 [36mtotal_tokens=[0m25
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0mmetrics [36magent_name=[0mMetricsAgent [36minput_tokens=[0m26 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mMetricsAgent [36mattempt=[0m1 [36mduration=[0m20.237424ms
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m26 [36mmodel=[0mmock [36moutput_tokens=[0m17
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mMetricsAgent [36mcost=[0m0 [36mduration_ms=[0m20 [36minput_tokens=[0m26 [36mmodel=[0mmock [36moutput_tokens=[0m17 [36mtotal_tokens=[0m43
--- PASS: TestConversationWithMetrics (0.06s)
=== RUN   TestConversationInitialPrompt
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent added to orchestrator[0m [36magent_id=[0minitial [36magent_name=[0mInitialAgent [36magent_type=[0mmock [36mburst=[0m1 [36mrate_limit=[0m0
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1mstarting conversation[0m [36magents=[0m1 [36mhas_prompt=[0mtrue [36mmax_turns=[0m1 [36mmode=[0mround-robin
[90m2025-10-29T02:57:29Z[0m DBG requesting agent response [36magent_id=[0minitial [36magent_name=[0mInitialAgent [36minput_tokens=[0m20 [36mmax_retries=[0m3
[90m2025-10-29T02:57:29Z[0m DBG agent response received [36magent_name=[0mInitialAgent [36mattempt=[0m1 [36mduration=[0m"6.202µs"
[90m2025-10-29T02:57:29Z[0m [33mWRN[0m [1mmodel not found in provider registry, cost estimate will be $0.00[0m [36minput_tokens=[0m20 [36mmodel=[0mmock [36moutput_tokens=[0m6
[90m2025-10-29T02:57:29Z[0m [32mINF[0m [1magent response successful[0m [36magent_name=[0mInitialAgent [36mcost=[0m0 [36mduration_ms=[0m0 [36minput_tokens=[0m20 [36mmodel=[0mmock [36moutput_tokens=[0m6 [36mtotal_tokens=[0m26
--- PASS: TestConversationInitialPrompt (0.01s)
PASS
ok  	github.com/kevinelliott/agentpipe/test/integration	2.987s
FAIL
